Ext.grid.GridPanel=Ext.extend(Ext.Panel,{autoExpandColumn:false,autoExpandMax:1000,autoExpandMin:50,columnLines:false,ddText:"{0} selected row{1}",deferRowRender:true,enableColumnHide:true,enableColumnMove:true,enableDragDrop:false,enableHdMenu:true,loadMask:false,minColumnWidth:25,stripeRows:false,trackMouseOver:true,stateEvents:["columnmove","columnresize","sortchange","groupchange"],view:null,bubbleEvents:[],rendered:false,viewReady:false,initComponent:function(){Ext.grid.GridPanel.superclass.initComponent.call(this);if(this.columnLines){this.cls=(this.cls||"")+" x-grid-with-col-lines"}this.autoScroll=false;this.autoWidth=false;if(Ext.isArray(this.columns)){this.colModel=new Ext.grid.ColumnModel(this.columns);delete this.columns}if(this.ds){this.store=this.ds;delete this.ds}if(this.cm){this.colModel=this.cm;delete this.cm}if(this.sm){this.selModel=this.sm;delete this.sm}this.store=Ext.StoreMgr.lookup(this.store);this.addEvents("click","dblclick","contextmenu","mousedown","mouseup","mouseover","mouseout","keypress","keydown","cellmousedown","rowmousedown","headermousedown","groupmousedown","rowbodymousedown","containermousedown","cellclick","celldblclick","rowclick","rowdblclick","headerclick","headerdblclick","groupclick","groupdblclick","containerclick","containerdblclick","rowbodyclick","rowbodydblclick","rowcontextmenu","cellcontextmenu","headercontextmenu","groupcontextmenu","containercontextmenu","rowbodycontextmenu","bodyscroll","columnresize","columnmove","sortchange","groupchange","reconfigure","viewready")},onRender:function(h,f){Ext.grid.GridPanel.superclass.onRender.apply(this,arguments);var g=this.getGridEl();this.el.addClass("x-grid-panel");this.mon(g,{scope:this,mousedown:this.onMouseDown,click:this.onClick,dblclick:this.onDblClick,contextmenu:this.onContextMenu});this.relayEvents(g,["mousedown","mouseup","mouseover","mouseout","keypress","keydown"]);var c=this.getView();c.init(this);c.render();this.getSelectionModel().init(this)},initEvents:function(){Ext.grid.GridPanel.superclass.initEvents.call(this);if(this.loadMask){this.loadMask=new Ext.LoadMask(this.bwrap,Ext.apply({store:this.store},this.loadMask))}},initStateEvents:function(){Ext.grid.GridPanel.superclass.initStateEvents.call(this);this.mon(this.colModel,"hiddenchange",this.saveState,this,{delay:100})},applyState:function(t){var m=this.colModel,p=t.columns,n=this.store,c,o,i;if(p){for(var r=0,q=p.length;r<q;r++){c=p[r];o=m.getColumnById(c.id);if(o){i=m.getIndexById(c.id);m.setState(i,{hidden:c.hidden,width:c.width,sortable:c.sortable});if(i!=r){m.moveColumn(i,r)}}}}if(n){c=t.sort;if(c){n[n.remoteSort?"setDefaultSort":"sort"](c.field,c.direction)}c=t.group;if(n.groupBy){if(c){n.groupBy(c)}else{n.clearGrouping()}}}var s=Ext.apply({},t);delete s.columns;delete s.sort;Ext.grid.GridPanel.superclass.applyState.call(this,s)},getState:function(){var j={columns:[]},c=this.store,k,h;for(var l=0,i;(i=this.colModel.config[l]);l++){j.columns[l]={id:i.id,width:i.width};if(i.hidden){j.columns[l].hidden=true}if(i.sortable){j.columns[l].sortable=true}}if(c){k=c.getSortState();if(k){j.sort=k}if(c.getGroupState){h=c.getGroupState();if(h){j.group=h}}}return j},afterRender:function(){Ext.grid.GridPanel.superclass.afterRender.call(this);var b=this.view;this.on("bodyresize",b.layout,b);b.layout(true);if(this.deferRowRender){if(!this.deferRowRenderTask){this.deferRowRenderTask=new Ext.util.DelayedTask(b.afterRender,this.view)}this.deferRowRenderTask.delay(10)}else{b.afterRender()}this.viewReady=true},reconfigure:function(e,d){var f=this.rendered;if(f){if(this.loadMask){this.loadMask.destroy();this.loadMask=new Ext.LoadMask(this.bwrap,Ext.apply({},{store:e},this.initialConfig.loadMask))}}if(this.view){this.view.initData(e,d)}this.store=e;this.colModel=d;if(f){this.view.refresh(true)}this.fireEvent("reconfigure",this,e,d)},onDestroy:function(){if(this.deferRowRenderTask&&this.deferRowRenderTask.cancel){this.deferRowRenderTask.cancel()}if(this.rendered){Ext.destroy(this.view,this.loadMask)}else{if(this.store&&this.store.autoDestroy){this.store.destroy()}}Ext.destroy(this.colModel,this.selModel);this.store=this.selModel=this.colModel=this.view=this.loadMask=null;Ext.grid.GridPanel.superclass.onDestroy.call(this)},processEvent:function(d,c){this.view.processEvent(d,c)},onClick:function(b){this.processEvent("click",b)},onMouseDown:function(b){this.processEvent("mousedown",b)},onContextMenu:function(c,d){this.processEvent("contextmenu",c)},onDblClick:function(b){this.processEvent("dblclick",b)},walkCells:function(k,r,s,p,l){var m=this.colModel,o=m.getColumnCount(),t=this.store,n=t.getCount(),q=true;if(s<0){if(r<0){k--;q=false}while(k>=0){if(!q){r=o-1}q=false;while(r>=0){if(p.call(l||this,k,r,m)===true){return[k,r]}r--}k--}}else{if(r>=o){k++;q=false}while(k<n){if(!q){r=0}q=false;while(r<o){if(p.call(l||this,k,r,m)===true){return[k,r]}r++}k++}}return null},getGridEl:function(){return this.body},stopEditing:Ext.emptyFn,getSelectionModel:function(){if(!this.selModel){this.selModel=new Ext.grid.RowSelectionModel(this.disableSelection?{selectRow:Ext.emptyFn}:null)}return this.selModel},getStore:function(){return this.store},getColumnModel:function(){return this.colModel},getView:function(){if(!this.view){this.view=new Ext.grid.GridView(this.viewConfig)}return this.view},getDragDropText:function(){var b=this.selModel.getCount();return String.format(this.ddText,b,b==1?"":"s")}});Ext.reg("grid",Ext.grid.GridPanel);Ext.grid.PivotGrid=Ext.extend(Ext.grid.GridPanel,{aggregator:"sum",renderer:undefined,initComponent:function(){Ext.grid.PivotGrid.superclass.initComponent.apply(this,arguments);this.initAxes();this.enableColumnResize=false;this.viewConfig=Ext.apply(this.viewConfig||{},{forceFit:true});this.colModel=new Ext.grid.ColumnModel({})},getAggregator:function(){if(typeof this.aggregator=="string"){return Ext.grid.PivotAggregatorMgr.types[this.aggregator]}else{return this.aggregator}},setAggregator:function(b){this.aggregator=b},setMeasure:function(b){this.measure=b},setLeftAxis:function(c,d){this.leftAxis=c;if(d){this.view.refresh()}},setTopAxis:function(c,d){this.topAxis=c;if(d){this.view.refresh()}},initAxes:function(){var b=Ext.grid.PivotAxis;if(!(this.leftAxis instanceof b)){this.setLeftAxis(new b({orientation:"vertical",dimensions:this.leftAxis||[],store:this.store}))}if(!(this.topAxis instanceof b)){this.setTopAxis(new b({orientation:"horizontal",dimensions:this.topAxis||[],store:this.store}))}},extractData:function(){var B=this.store.data.items,i=B.length,k=[],x,y,z,A;if(i==0){return[]}var w=this.leftAxis.getTuples(),t=w.length,v=this.topAxis.getTuples(),D=v.length,C=this.getAggregator();for(y=0;y<i;y++){x=B[y];for(z=0;z<t;z++){k[z]=k[z]||[];if(w[z].matcher(x)===true){for(A=0;A<D;A++){k[z][A]=k[z][A]||[];if(v[A].matcher(x)){k[z][A].push(x)}}}}}var u=k.length,s,j;for(y=0;y<u;y++){j=k[y];s=j.length;for(z=0;z<s;z++){k[y][z]=C(k[y][z],this.measure)}}return k},getView:function(){if(!this.view){this.view=new Ext.grid.PivotGridView(this.viewConfig)}return this.view}});Ext.reg("pivotgrid",Ext.grid.PivotGrid);Ext.grid.PivotAggregatorMgr=new Ext.AbstractManager();Ext.grid.PivotAggregatorMgr.registerType("sum",function(g,j){var h=g.length,i=0,f;for(f=0;f<h;f++){i+=g[f].get(j)}return i});Ext.grid.PivotAggregatorMgr.registerType("avg",function(g,j){var h=g.length,i=0,f;for(f=0;f<h;f++){i+=g[f].get(j)}return(i/h)||"n/a"});Ext.grid.PivotAggregatorMgr.registerType("min",function(g,j){var h=[],i=g.length,f;for(f=0;f<i;f++){h.push(g[f].get(j))}return Math.min.apply(this,h)||"n/a"});Ext.grid.PivotAggregatorMgr.registerType("max",function(g,j){var h=[],i=g.length,f;for(f=0;f<i;f++){h.push(g[f].get(j))}return Math.max.apply(this,h)||"n/a"});Ext.grid.PivotAggregatorMgr.registerType("count",function(d,c){return d.length});Ext.grid.GridView=Ext.extend(Ext.util.Observable,{deferEmptyText:true,scrollOffset:undefined,autoFill:false,forceFit:false,sortClasses:["sort-asc","sort-desc"],sortAscText:"Sort Ascending",sortDescText:"Sort Descending",columnsText:"Columns",selectedRowClass:"x-grid3-row-selected",borderWidth:2,tdClass:"x-grid3-cell",hdCls:"x-grid3-hd",markDirty:true,cellSelectorDepth:4,rowSelectorDepth:10,rowBodySelectorDepth:10,cellSelector:"td.x-grid3-cell",rowSelector:"div.x-grid3-row",rowBodySelector:"div.x-grid3-row-body",firstRowCls:"x-grid3-row-first",lastRowCls:"x-grid3-row-last",rowClsRe:/(?:^|\s+)x-grid3-row-(first|last|alt)(?:\s+|$)/g,headerMenuOpenCls:"x-grid3-hd-menu-open",rowOverCls:"x-grid3-row-over",constructor:function(b){Ext.apply(this,b);this.addEvents("beforerowremoved","beforerowsinserted","beforerefresh","rowremoved","rowsinserted","rowupdated","refresh");Ext.grid.GridView.superclass.constructor.call(this)},masterTpl:new Ext.Template('<div class="x-grid3" hidefocus="true">','<div class="x-grid3-viewport">','<div class="x-grid3-header">','<div class="x-grid3-header-inner">','<div class="x-grid3-header-offset" style="{ostyle}">{header}</div>',"</div>",'<div class="x-clear"></div>',"</div>",'<div class="x-grid3-scroller">','<div class="x-grid3-body" style="{bstyle}">{body}</div>','<a href="#" class="x-grid3-focus" tabIndex="-1"></a>',"</div>","</div>",'<div class="x-grid3-resize-marker">&#160;</div>','<div class="x-grid3-resize-proxy">&#160;</div>',"</div>"),headerTpl:new Ext.Template('<table border="0" cellspacing="0" cellpadding="0" style="{tstyle}">',"<thead>",'<tr class="x-grid3-hd-row">{cells}</tr>',"</thead>","</table>"),bodyTpl:new Ext.Template("{rows}"),cellTpl:new Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} {css}" style="{style}" tabIndex="0" {cellAttr}>','<div class="x-grid3-cell-inner x-grid3-col-{id}" unselectable="on" {attr}>{value}</div>',"</td>"),initTemplates:function(){var l=this.templates||{},k,g,i=new Ext.Template('<td class="x-grid3-hd x-grid3-cell x-grid3-td-{id} {css}" style="{style}">','<div {tooltip} {attr} class="x-grid3-hd-inner x-grid3-hd-{id}" unselectable="on" style="{istyle}">',this.grid.enableHdMenu?'<a class="x-grid3-hd-btn" href="#"></a>':"","{value}",'<img alt="" class="x-grid3-sort-icon" src="',Ext.BLANK_IMAGE_URL,'" />',"</div>","</td>"),h=['<tr class="x-grid3-row-body-tr" style="{bodyStyle}">','<td colspan="{cols}" class="x-grid3-body-cell" tabIndex="0" hidefocus="on">','<div class="x-grid3-row-body">{body}</div>',"</td>","</tr>"].join(""),j=['<table class="x-grid3-row-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">',"<tbody>","<tr>{cells}</tr>",this.enableRowBody?h:"","</tbody>","</table>"].join("");Ext.applyIf(l,{hcell:i,cell:this.cellTpl,body:this.bodyTpl,header:this.headerTpl,master:this.masterTpl,row:new Ext.Template('<div class="x-grid3-row {alt}" style="{tstyle}">'+j+"</div>"),rowInner:new Ext.Template(j)});for(g in l){k=l[g];if(k&&Ext.isFunction(k.compile)&&!k.compiled){k.disableFormats=true;k.compile()}}this.templates=l;this.colRe=new RegExp("x-grid3-td-([^\\s]+)","")},fly:function(b){if(!this._flyweight){this._flyweight=new Ext.Element.Flyweight(document.body)}this._flyweight.dom=b;return this._flyweight},getEditorParent:function(){return this.scroller.dom},initElements:function(){var f=Ext.Element,i=Ext.get(this.grid.getGridEl().dom.firstChild),h=new f(i.child("div.x-grid3-viewport")),j=new f(h.child("div.x-grid3-header")),g=new f(h.child("div.x-grid3-scroller"));if(this.grid.hideHeaders){j.setDisplayed(false)}if(this.forceFit){g.setStyle("overflow-x","hidden")}Ext.apply(this,{el:i,mainWrap:h,scroller:g,mainHd:j,innerHd:j.child("div.x-grid3-header-inner").dom,mainBody:new f(f.fly(g).child("div.x-grid3-body")),focusEl:new f(f.fly(g).child("a")),resizeMarker:new f(i.child("div.x-grid3-resize-marker")),resizeProxy:new f(i.child("div.x-grid3-resize-proxy"))});this.focusEl.swallowEvent("click",true)},getRows:function(){return this.hasRows()?this.mainBody.dom.childNodes:[]},findCell:function(b){if(!b){return false}return this.fly(b).findParent(this.cellSelector,this.cellSelectorDepth)},findCellIndex:function(g,h){var e=this.findCell(g),f;if(e){f=this.fly(e).hasClass(h);if(!h||f){return this.getCellIndex(e)}}return false},getCellIndex:function(c){if(c){var d=c.className.match(this.colRe);if(d&&d[1]){return this.cm.getIndexById(d[1])}}return false},findHeaderCell:function(c){var d=this.findCell(c);return d&&this.fly(d).hasClass(this.hdCls)?d:null},findHeaderIndex:function(b){return this.findCellIndex(b,this.hdCls)},findRow:function(b){if(!b){return false}return this.fly(b).findParent(this.rowSelector,this.rowSelectorDepth)},findRowIndex:function(d){var c=this.findRow(d);return c?c.rowIndex:false},findRowBody:function(b){if(!b){return false}return this.fly(b).findParent(this.rowBodySelector,this.rowBodySelectorDepth)},getRow:function(b){return this.getRows()[b]},getCell:function(c,d){return Ext.fly(this.getRow(c)).query(this.cellSelector)[d]},getHeaderCell:function(b){return this.mainHd.dom.getElementsByTagName("td")[b]},addRowClass:function(d,e){var f=this.getRow(d);if(f){this.fly(f).addClass(e)}},removeRowClass:function(f,e){var d=this.getRow(f);if(d){this.fly(d).removeClass(e)}},removeRow:function(b){Ext.removeNode(this.getRow(b));this.syncFocusEl(b)},removeRows:function(h,f){var e=this.mainBody.dom,g;for(g=h;g<=f;g++){Ext.removeNode(e.childNodes[h])}this.syncFocusEl(h)},getScrollState:function(){var b=this.scroller.dom;return{left:b.scrollLeft,top:b.scrollTop}},restoreScroll:function(d){var c=this.scroller.dom;c.scrollLeft=d.left;c.scrollTop=d.top},scrollToTop:function(){var b=this.scroller.dom;b.scrollTop=0;b.scrollLeft=0},syncScroll:function(){this.syncHeaderScroll();var b=this.scroller.dom;this.grid.fireEvent("bodyscroll",b.scrollLeft,b.scrollTop)},syncHeaderScroll:function(){var d=this.innerHd,c=this.scroller.dom.scrollLeft;d.scrollLeft=c;d.scrollLeft=c},updateSortIcon:function(i,j){var g=this.sortClasses,f=g[j=="DESC"?1:0],h=this.mainHd.select("td").removeClass(g);h.item(i).addClass(f)},updateAllColumnWidths:function(){var p=this.getTotalWidth(),m=this.cm.getColumnCount(),i=this.getRows(),o=i.length,s=[],j,t,n,q,r;for(q=0;q<m;q++){s[q]=this.getColumnWidth(q);this.getHeaderCell(q).style.width=s[q]}this.updateHeaderWidth();for(q=0;q<o;q++){j=i[q];j.style.width=p;t=j.firstChild;if(t){t.style.width=p;n=t.rows[0];for(r=0;r<m;r++){n.childNodes[r].style.width=s[r]}}}this.onAllColumnWidthsUpdated(s,p)},updateColumnWidth:function(q,s){var r=this.getColumnWidth(q),m=this.getTotalWidth(),n=this.getHeaderCell(q),t=this.getRows(),p=t.length,i,o,l;this.updateHeaderWidth();n.style.width=r;for(o=0;o<p;o++){i=t[o];l=i.firstChild;i.style.width=m;if(l){l.style.width=m;l.rows[0].childNodes[q].style.width=r}}this.onColumnWidthUpdated(q,r,m)},updateColumnHidden:function(s,m){var n=this.getTotalWidth(),l=m?"none":"",o=this.getHeaderCell(s),t=this.getRows(),q=t.length,i,r,p;this.updateHeaderWidth();o.style.display=l;for(p=0;p<q;p++){i=t[p];i.style.width=n;r=i.firstChild;if(r){r.style.width=n;r.rows[0].childNodes[s].style.display=l}}this.onColumnHiddenUpdated(s,m,n);delete this.lastViewWidth;this.layout()},doRender:function(O,z,I,R,D,B){var L=this.templates,P=L.cell,i=L.row,G=D-1,Q="width:"+this.getTotalWidth()+";",K=[],J=[],H={tstyle:Q},E={},y=z.length,j,M,N,A,C,F;for(C=0;C<y;C++){N=z[C];J=[];F=C+R;for(A=0;A<D;A++){M=O[A];E.id=M.id;E.css=A===0?"x-grid3-cell-first ":(A==G?"x-grid3-cell-last ":"");E.attr=E.cellAttr="";E.style=M.style;E.value=M.renderer.call(M.scope,N.data[M.name],E,N,F,A,I);if(Ext.isEmpty(E.value)){E.value="&#160;"}if(this.markDirty&&N.dirty&&typeof N.modified[M.name]!="undefined"){E.css+=" x-grid3-dirty-cell"}J[J.length]=P.apply(E)}j=[];if(B&&((F+1)%2===0)){j[0]="x-grid3-row-alt"}if(N.dirty){j[1]=" x-grid3-dirty-row"}H.cols=D;if(this.getRowClass){j[2]=this.getRowClass(N,F,H,I)}H.alt=j.join(" ");H.cells=J.join("");K[K.length]=i.apply(H)}return K.join("")},processRows:function(h,i){if(!this.ds||this.ds.getCount()<1){return}var k=this.getRows(),l=k.length,j,g;i=i||!this.grid.stripeRows;h=h||0;for(g=0;g<l;g++){j=k[g];if(j){j.rowIndex=g;if(!i){j.className=j.className.replace(this.rowClsRe," ");if((g+1)%2===0){j.className+=" x-grid3-row-alt"}}}}if(h===0){Ext.fly(k[0]).addClass(this.firstRowCls)}Ext.fly(k[l-1]).addClass(this.lastRowCls)},afterRender:function(){if(!this.ds||!this.cm){return}this.mainBody.dom.innerHTML=this.renderBody()||"&#160;";this.processRows(0,true);if(this.deferEmptyText!==true){this.applyEmptyText()}this.grid.fireEvent("viewready",this.grid)},afterRenderUI:function(){var b=this.grid;this.initElements();Ext.fly(this.innerHd).on("click",this.handleHdDown,this);this.mainHd.on({scope:this,mouseover:this.handleHdOver,mouseout:this.handleHdOut,mousemove:this.handleHdMove});this.scroller.on("scroll",this.syncScroll,this);if(b.enableColumnResize!==false){this.splitZone=new Ext.grid.GridView.SplitDragZone(b,this.mainHd.dom)}if(b.enableColumnMove){this.columnDrag=new Ext.grid.GridView.ColumnDragZone(b,this.innerHd);this.columnDrop=new Ext.grid.HeaderDropZone(b,this.mainHd.dom)}if(b.enableHdMenu!==false){this.hmenu=new Ext.menu.Menu({id:b.id+"-hctx"});this.hmenu.add({itemId:"asc",text:this.sortAscText,cls:"xg-hmenu-sort-asc"},{itemId:"desc",text:this.sortDescText,cls:"xg-hmenu-sort-desc"});if(b.enableColumnHide!==false){this.colMenu=new Ext.menu.Menu({id:b.id+"-hcols-menu"});this.colMenu.on({scope:this,beforeshow:this.beforeColMenuShow,itemclick:this.handleHdMenuClick});this.hmenu.add("-",{itemId:"columns",hideOnClick:false,text:this.columnsText,menu:this.colMenu,iconCls:"x-cols-icon"})}this.hmenu.on("itemclick",this.handleHdMenuClick,this)}if(b.trackMouseOver){this.mainBody.on({scope:this,mouseover:this.onRowOver,mouseout:this.onRowOut})}if(b.enableDragDrop||b.enableDrag){this.dragZone=new Ext.grid.GridDragZone(b,{ddGroup:b.ddGroup||"GridDD"})}this.updateHeaderSortState()},renderUI:function(){var b=this.templates;return b.master.apply({body:b.body.apply({rows:"&#160;"}),header:this.renderHeaders(),ostyle:"width:"+this.getOffsetWidth()+";",bstyle:"width:"+this.getTotalWidth()+";"})},processEvent:function(q,m){var l=m.getTarget(),r=this.grid,o=this.findHeaderIndex(l),e,k,p,n;r.fireEvent(q,m);if(o!==false){r.fireEvent("header"+q,r,o,m)}else{e=this.findRowIndex(l);if(e!==false){k=this.findCellIndex(l);if(k!==false){p=r.colModel.getColumnAt(k);if(r.fireEvent("cell"+q,r,e,k,m)!==false){if(!p||(p.processEvent&&(p.processEvent(q,m,r,e,k)!==false))){r.fireEvent("row"+q,r,e,m)}}}else{if(r.fireEvent("row"+q,r,e,m)!==false){(n=this.findRowBody(l))&&r.fireEvent("rowbody"+q,r,e,m)}}}else{r.fireEvent("container"+q,r,m)}}},layout:function(l){if(!this.mainBody){return}var t=this.grid,q=t.getGridEl(),r=q.getSize(true),m=r.width,s=r.height,n=this.scroller,o,p,k;if(m<20||s<20){return}if(t.autoHeight){o=n.dom.style;o.overflow="visible";if(Ext.isWebKit){o.position="static"}}else{this.el.setSize(m,s);p=this.mainHd.getHeight();k=s-p;n.setSize(m,k);if(this.innerHd){this.innerHd.style.width=(m)+"px"}}if(this.forceFit||(l===true&&this.autoFill)){if(this.lastViewWidth!=m){this.fitColumns(false,false);this.lastViewWidth=m}}else{this.autoExpand();this.syncHeaderScroll()}this.onLayout(m,k)},onLayout:function(d,c){},onColumnWidthUpdated:function(f,e,d){},onAllColumnWidthsUpdated:function(d,c){},onColumnHiddenUpdated:function(d,f,e){},updateColumnText:function(d,c){},afterMove:function(b){},init:function(b){this.grid=b;this.initTemplates();this.initData(b.store,b.colModel);this.initUI(b)},getColumnId:function(b){return this.cm.getColumnId(b)},getOffsetWidth:function(){return(this.cm.getTotalWidth()+this.getScrollOffset())+"px"},getScrollOffset:function(){return Ext.num(this.scrollOffset,Ext.getScrollBarWidth())},renderHeaders:function(){var n=this.cm,m=this.templates,r=m.hcell,o={},l=n.getColumnCount(),k=l-1,i=[],p,q;for(p=0;p<l;p++){if(p==0){q="x-grid3-cell-first "}else{q=p==k?"x-grid3-cell-last ":""}o={id:n.getColumnId(p),value:n.getColumnHeader(p)||"",style:this.getColumnStyle(p,true),css:q,tooltip:this.getColumnTooltip(p)};if(n.config[p].align=="right"){o.istyle="padding-right: 16px;"}else{delete o.istyle}i[p]=r.apply(o)}return m.header.apply({cells:i.join(""),tstyle:String.format("width: {0};",this.getTotalWidth())})},getColumnTooltip:function(d){var c=this.cm.getColumnTooltip(d);if(c){if(Ext.QuickTips.isEnabled()){return'ext:qtip="'+c+'"'}else{return'title="'+c+'"'}}return""},beforeUpdate:function(){this.grid.stopEditing(true)},updateHeaders:function(){this.innerHd.firstChild.innerHTML=this.renderHeaders();this.updateHeaderWidth(false)},updateHeaderWidth:function(f){var d=this.innerHd.firstChild,e=this.getTotalWidth();d.style.width=this.getOffsetWidth();d.firstChild.style.width=e;if(f!==false){this.mainBody.dom.style.width=e}},focusRow:function(b){this.focusCell(b,0,false)},focusCell:function(g,e,h){this.syncFocusEl(this.ensureVisible(g,e,h));var f=this.focusEl;if(Ext.isGecko){f.focus()}else{f.focus.defer(1,f)}},resolveCell:function(j,m,k){if(!Ext.isNumber(j)){j=j.rowIndex}if(!this.ds){return null}if(j<0||j>=this.ds.getCount()){return null}m=(m!==undefined?m:0);var n=this.getRow(j),h=this.cm,l=h.getColumnCount(),i;if(!(k===false&&m===0)){while(m<l&&h.isHidden(m)){m++}i=this.getCell(j,m)}return{row:n,cell:i}},getResolvedXY:function(d){if(!d){return null}var e=d.cell,f=d.row;if(e){return Ext.fly(e).getXY()}else{return[this.el.getX(),Ext.fly(f).getY()]}},syncFocusEl:function(g,f,h){var e=g;if(!Ext.isArray(e)){g=Math.min(g,Math.max(0,this.getRows().length-1));if(isNaN(g)){return}e=this.getResolvedXY(this.resolveCell(g,f,h))}this.focusEl.setXY(e||this.scroller.getXY())},ensureVisible:function(H,C,D){var p=this.resolveCell(H,C,D);if(!p||!p.row){return null}var y=p.row,B=p.cell,v=this.scroller.dom,E=y,c=0,u=this.el.dom;while(E&&E!=u){c+=E.offsetTop;E=E.offsetParent}c-=this.mainHd.dom.offsetHeight;u=parseInt(v.scrollTop,10);var t=c+y.offsetHeight,G=v.clientHeight,w=u+G;if(c<u){v.scrollTop=c}else{if(t>w){v.scrollTop=t-G}}if(D!==false){var x=parseInt(B.offsetLeft,10),z=x+B.offsetWidth,A=parseInt(v.scrollLeft,10),F=A+v.clientWidth;if(x<A){v.scrollLeft=x}else{if(z>F){v.scrollLeft=z-v.clientWidth}}}return this.getResolvedXY(p)},insertRows:function(j,k,n,l){var o=j.getCount()-1;if(!l&&k===0&&n>=o){this.fireEvent("beforerowsinserted",this,k,n);this.refresh();this.fireEvent("rowsinserted",this,k,n)}else{if(!l){this.fireEvent("beforerowsinserted",this,k,n)}var i=this.renderRows(k,n),m=this.getRow(k);if(m){if(k===0){Ext.fly(this.getRow(0)).removeClass(this.firstRowCls)}Ext.DomHelper.insertHtml("beforeBegin",m,i)}else{var p=this.getRow(o-1);if(p){Ext.fly(p).removeClass(this.lastRowCls)}Ext.DomHelper.insertHtml("beforeEnd",this.mainBody.dom,i)}if(!l){this.processRows(k);this.fireEvent("rowsinserted",this,k,n)}else{if(k===0||k>=o){Ext.fly(this.getRow(k)).addClass(k===0?this.firstRowCls:this.lastRowCls)}}}this.syncFocusEl(k)},deleteRows:function(e,f,d){if(e.getRowCount()<1){this.refresh()}else{this.fireEvent("beforerowsdeleted",this,f,d);this.removeRows(f,d);this.processRows(f);this.fireEvent("rowsdeleted",this,f,d)}},getColumnStyle:function(g,k){var h=this.cm,i=h.config,l=k?"":i[g].css||"",j=i[g].align;l+=String.format("width: {0};",this.getColumnWidth(g));if(h.isHidden(g)){l+="display: none; "}if(j){l+=String.format("text-align: {0};",j)}return l},getColumnWidth:function(d){var f=this.cm.getColumnWidth(d),e=this.borderWidth;if(Ext.isNumber(f)){if(Ext.isBorderBox||(Ext.isWebKit&&!Ext.isSafari2)){return f+"px"}else{return Math.max(f-e,0)+"px"}}else{return f}},getTotalWidth:function(){return this.cm.getTotalWidth()+"px"},fitColumns:function(G,E,F){var L=this.grid,C=this.cm,v=C.getTotalWidth(false),x=this.getGridInnerWidth(),w=x-v,J=[],z=0,A=0,i,I,y;if(x<20||w===0){return false}var H=C.getColumnCount(true),B=C.getColumnCount(false),K=H-(Ext.isNumber(F)?1:0);if(K===0){K=1;F=undefined}for(y=0;y<B;y++){if(!C.isFixed(y)&&y!==F){i=C.getColumnWidth(y);J.push(y,i);if(!C.isHidden(y)){z=y;A+=i}}}I=(x-C.getTotalWidth())/A;while(J.length){i=J.pop();y=J.pop();C.setColumnWidth(y,Math.max(L.minColumnWidth,Math.floor(i+i*I)),true)}v=C.getTotalWidth(false);if(v>x){var u=(K==H)?z:F,D=Math.max(1,C.getColumnWidth(u)-(v-x));C.setColumnWidth(u,D,true)}if(G!==true){this.updateAllColumnWidths()}return true},autoExpand:function(k){var t=this.grid,m=this.cm,p=this.getGridInnerWidth(),r=m.getTotalWidth(false),o=t.autoExpandColumn;if(!this.userResized&&o){if(p!=r){var l=m.getIndexById(o),s=m.getColumnWidth(l),n=p-r+s,q=Math.min(Math.max(n,t.autoExpandMin),t.autoExpandMax);if(s!=q){m.setColumnWidth(l,q,true);if(k!==true){this.updateColumnWidth(l,q)}}}}},getGridInnerWidth:function(){return this.grid.getGridEl().getWidth(true)-this.getScrollOffset()},getColumnData:function(){var j=[],l=this.cm,i=l.getColumnCount(),h=this.ds.fields,k,g;for(k=0;k<i;k++){g=l.getDataIndex(k);j[k]={name:Ext.isDefined(g)?g:(h.get(k)?h.get(k).name:undefined),renderer:l.getRenderer(k),scope:l.getRendererScope(k),id:l.getColumnId(k),style:this.getColumnStyle(k)}}return j},renderRows:function(k,p){var r=this.grid,m=r.store,j=r.stripeRows,n=r.colModel,l=n.getColumnCount(),o=m.getCount(),q;if(o<1){return""}k=k||0;p=Ext.isDefined(p)?p:o-1;q=m.getRange(k,p);return this.doRender(this.getColumnData(),q,m,k,l,j)},renderBody:function(){var b=this.renderRows()||"&#160;";return this.templates.body.apply({rows:b})},refreshRow:function(y){var u=this.ds,t=this.cm.getColumnCount(),B=this.getColumnData(),s=t-1,q=["x-grid3-row"],z={tstyle:String.format("width: {0};",this.getTotalWidth())},D=[],v=this.templates.cell,w,i,C,r,x,A;if(Ext.isNumber(y)){w=y;y=u.getAt(w)}else{w=u.indexOf(y)}if(!y||w<0){return}for(A=0;A<t;A++){C=B[A];if(A==0){x="x-grid3-cell-first"}else{x=(A==s)?"x-grid3-cell-last ":""}r={id:C.id,style:C.style,css:x,attr:"",cellAttr:""};r.value=C.renderer.call(C.scope,y.data[C.name],r,y,w,A,u);if(Ext.isEmpty(r.value)){r.value="&#160;"}if(this.markDirty&&y.dirty&&typeof y.modified[C.name]!="undefined"){r.css+=" x-grid3-dirty-cell"}D[A]=v.apply(r)}i=this.getRow(w);i.className="";if(this.grid.stripeRows&&((w+1)%2===0)){q.push("x-grid3-row-alt")}if(this.getRowClass){z.cols=t;q.push(this.getRowClass(y,w,z,u))}this.fly(i).addClass(q).setStyle(z.tstyle);z.cells=D.join("");i.innerHTML=this.templates.rowInner.apply(z);this.fireEvent("rowupdated",this,w,y)},refresh:function(c){this.fireEvent("beforerefresh",this);this.grid.stopEditing(true);var d=this.renderBody();this.mainBody.update(d).setWidth(this.getTotalWidth());if(c===true){this.updateHeaders();this.updateHeaderSortState()}this.processRows(0,true);this.layout();this.applyEmptyText();this.fireEvent("refresh",this)},applyEmptyText:function(){if(this.emptyText&&!this.hasRows()){this.mainBody.update('<div class="x-grid-empty">'+this.emptyText+"</div>")}},updateHeaderSortState:function(){var d=this.ds.getSortState();if(!d){return}if(!this.sortState||(this.sortState.field!=d.field||this.sortState.direction!=d.direction)){this.grid.fireEvent("sortchange",this.grid,d)}this.sortState=d;var f=this.cm.findColumnIndex(d.field);if(f!=-1){var e=d.direction;this.updateSortIcon(f,e)}},clearHeaderSortState:function(){if(!this.sortState){return}this.grid.fireEvent("sortchange",this.grid,null);this.mainHd.select("td").removeClass(this.sortClasses);delete this.sortState},destroy:function(){var l=this,t=l.grid,q=t.getGridEl(),m=l.dragZone,o=l.splitZone,n=l.columnDrag,p=l.columnDrop,k=l.scrollToTopTask,r,s;if(k&&k.cancel){k.cancel()}Ext.destroyMembers(l,"colMenu","hmenu");l.initData(null,null);l.purgeListeners();Ext.fly(l.innerHd).un("click",l.handleHdDown,l);if(t.enableColumnMove){r=n.dragData;s=n.proxy;Ext.destroy(n.el,s.ghost,s.el,p.el,p.proxyTop,p.proxyBottom,r.ddel,r.header);if(s.anim){Ext.destroy(s.anim)}delete s.ghost;delete r.ddel;delete r.header;n.destroy();delete Ext.dd.DDM.locationCache[n.id];delete n._domRef;delete p.proxyTop;delete p.proxyBottom;p.destroy();delete Ext.dd.DDM.locationCache["gridHeader"+q.id];delete p._domRef;delete Ext.dd.DDM.ids[p.ddGroup]}if(o){o.destroy();delete o._domRef;delete Ext.dd.DDM.ids["gridSplitters"+q.id]}Ext.fly(l.innerHd).removeAllListeners();Ext.removeNode(l.innerHd);delete l.innerHd;Ext.destroy(l.el,l.mainWrap,l.mainHd,l.scroller,l.mainBody,l.focusEl,l.resizeMarker,l.resizeProxy,l.activeHdBtn,l._flyweight,m,o);delete t.container;if(m){m.destroy()}Ext.dd.DDM.currentTarget=null;delete Ext.dd.DDM.locationCache[q.id];Ext.EventManager.removeResizeListener(l.onWindowResize,l)},onDenyColumnHide:function(){},render:function(){if(this.autoFill){var b=this.grid.ownerCt;if(b&&b.getLayout()){b.on("afterlayout",function(){this.fitColumns(true,true);this.updateHeaders();this.updateHeaderSortState()},this,{single:true})}}else{if(this.forceFit){this.fitColumns(true,false)}else{if(this.grid.autoExpandColumn){this.autoExpand(true)}}}this.grid.getGridEl().dom.innerHTML=this.renderUI();this.afterRenderUI()},initData:function(g,h){var f=this;if(f.ds){var i=f.ds;i.un("add",f.onAdd,f);i.un("load",f.onLoad,f);i.un("clear",f.onClear,f);i.un("remove",f.onRemove,f);i.un("update",f.onUpdate,f);i.un("datachanged",f.onDataChange,f);if(i!==g&&i.autoDestroy){i.destroy()}}if(g){g.on({scope:f,load:f.onLoad,add:f.onAdd,remove:f.onRemove,update:f.onUpdate,clear:f.onClear,datachanged:f.onDataChange})}if(f.cm){var j=f.cm;j.un("configchange",f.onColConfigChange,f);j.un("widthchange",f.onColWidthChange,f);j.un("headerchange",f.onHeaderChange,f);j.un("hiddenchange",f.onHiddenChange,f);j.un("columnmoved",f.onColumnMove,f)}if(h){delete f.lastViewWidth;h.on({scope:f,configchange:f.onColConfigChange,widthchange:f.onColWidthChange,headerchange:f.onHeaderChange,hiddenchange:f.onHiddenChange,columnmoved:f.onColumnMove})}f.ds=g;f.cm=h},onDataChange:function(){this.refresh(true);this.updateHeaderSortState();this.syncFocusEl(0)},onClear:function(){this.refresh();this.syncFocusEl(0)},onUpdate:function(c,d){this.refreshRow(d)},onAdd:function(d,e,f){this.insertRows(d,f,f+(e.length-1))},onRemove:function(e,f,h,g){if(g!==true){this.fireEvent("beforerowremoved",this,h,f)}this.removeRow(h);if(g!==true){this.processRows(h);this.applyEmptyText();this.fireEvent("rowremoved",this,h,f)}},onLoad:function(){if(Ext.isGecko){if(!this.scrollToTopTask){this.scrollToTopTask=new Ext.util.DelayedTask(this.scrollToTop,this)}this.scrollToTopTask.delay(1)}else{this.scrollToTop()}},onColWidthChange:function(e,d,f){this.updateColumnWidth(d,f)},onHeaderChange:function(e,d,f){this.updateHeaders()},onHiddenChange:function(e,d,f){this.updateColumnHidden(d,f)},onColumnMove:function(e,f,d){this.indexMap=null;this.refresh(true);this.restoreScroll(this.getScrollState());this.afterMove(d);this.grid.fireEvent("columnmove",f,d)},onColConfigChange:function(){delete this.lastViewWidth;this.indexMap=null;this.refresh(true)},initUI:function(b){b.on("headerclick",this.onHeaderClick,this)},initEvents:Ext.emptyFn,onHeaderClick:function(c,d){if(this.headersDisabled||!this.cm.isSortable(d)){return}c.stopEditing(true);c.store.sort(this.cm.getDataIndex(d))},onRowOver:function(d,e){var f=this.findRowIndex(e);if(f!==false){this.addRowClass(f,this.rowOverCls)}},onRowOut:function(d,e){var f=this.findRowIndex(e);if(f!==false&&!d.within(this.getRow(f),true)){this.removeRowClass(f,this.rowOverCls)}},onRowSelect:function(b){this.addRowClass(b,this.selectedRowClass)},onRowDeselect:function(b){this.removeRowClass(b,this.selectedRowClass)},onCellSelect:function(f,d){var e=this.getCell(f,d);if(e){this.fly(e).addClass("x-grid3-cell-selected")}},onCellDeselect:function(f,d){var e=this.getCell(f,d);if(e){this.fly(e).removeClass("x-grid3-cell-selected")}},handleWheel:function(b){b.stopPropagation()},onColumnSplitterMoved:function(d,c){this.userResized=true;this.grid.colModel.setColumnWidth(d,c,true);if(this.forceFit){this.fitColumns(true,false,d);this.updateAllColumnWidths()}else{this.updateColumnWidth(d,c);this.syncHeaderScroll()}this.grid.fireEvent("columnresize",d,c)},beforeColMenuShow:function(){var e=this.cm,g=e.getColumnCount(),f=this.colMenu,h;f.removeAll();for(h=0;h<g;h++){if(e.config[h].hideable!==false){f.add(new Ext.menu.CheckItem({text:e.getColumnHeader(h),itemId:"col-"+e.getColumnId(h),checked:!e.isHidden(h),disabled:e.config[h].hideable===false,hideOnClick:false}))}}},handleHdMenuClick:function(f){var e=this.ds,d=this.cm.getDataIndex(this.hdCtxIndex);switch(f.getItemId()){case"asc":e.sort(d,"ASC");break;case"desc":e.sort(d,"DESC");break;default:this.handleHdMenuClickDefault(f)}return true},handleHdMenuClickDefault:function(h){var e=this.cm,g=h.getItemId(),f=e.getIndexById(g.substr(4));if(f!=-1){if(h.checked&&e.getColumnsBy(this.isHideableColumn,this).length<=1){this.onDenyColumnHide();return}e.setHidden(f,h.checked)}},handleHdDown:function(l,k){if(Ext.fly(k).hasClass("x-grid3-hd-btn")){l.stopEvent();var e=this.cm,n=this.findHeaderCell(k),m=this.getCellIndex(n),o=e.isSortable(m),p=this.hmenu,q=p.items,r=this.headerMenuOpenCls;this.hdCtxIndex=m;Ext.fly(n).addClass(r);q.get("asc").setDisabled(!o);q.get("desc").setDisabled(!o);p.on("hide",function(){Ext.fly(n).removeClass(r)},this,{single:true});p.show(k,"tl-bl?")}},handleHdMove:function(t){var v=this.findHeaderCell(this.activeHdRef);if(v&&!this.headersDisabled){var s=this.splitHandleWidth||5,u=this.activeHdRegion,e=v.style,r=this.cm,p="",x=t.getPageX();if(this.grid.enableColumnResize!==false){var B=this.activeHdIndex,A=this.getPreviousVisible(B),q=r.isResizable(B),z=A&&r.isResizable(A),y=x-u.left<=s,w=u.right-x<=(!this.activeHdBtn?s:2);if(y&&z){p=Ext.isAir?"move":Ext.isWebKit?"e-resize":"col-resize"}else{if(w&&q){p=Ext.isAir?"move":Ext.isWebKit?"w-resize":"col-resize"}}}e.cursor=p}},getPreviousVisible:function(b){while(b>0){if(!this.cm.isHidden(b-1)){return b}b--}return undefined},handleHdOver:function(h,e){var g=this.findHeaderCell(e);if(g&&!this.headersDisabled){var f=this.fly(g);this.activeHdRef=e;this.activeHdIndex=this.getCellIndex(g);this.activeHdRegion=f.getRegion();if(!this.isMenuDisabled(this.activeHdIndex,f)){f.addClass("x-grid3-hd-over");this.activeHdBtn=f.child(".x-grid3-hd-btn");if(this.activeHdBtn){this.activeHdBtn.dom.style.height=(g.firstChild.offsetHeight-1)+"px"}}}},handleHdOut:function(d,e){var f=this.findHeaderCell(e);if(f&&(!Ext.isIE||!d.within(f,true))){this.activeHdRef=null;this.fly(f).removeClass("x-grid3-hd-over");f.style.cursor=""}},isMenuDisabled:function(d,c){return this.cm.isMenuDisabled(d)},hasRows:function(){var b=this.mainBody.dom.firstChild;return b&&b.nodeType==1&&b.className!="x-grid-empty"},isHideableColumn:function(b){return !b.hidden},bind:function(d,c){this.initData(d,c)}});Ext.grid.GridView.SplitDragZone=Ext.extend(Ext.dd.DDProxy,{constructor:function(d,c){this.grid=d;this.view=d.getView();this.marker=this.view.resizeMarker;this.proxy=this.view.resizeProxy;Ext.grid.GridView.SplitDragZone.superclass.constructor.call(this,c,"gridSplitters"+this.grid.getGridEl().id,{dragElId:Ext.id(this.proxy.dom),resizeFrame:false});this.scroll=false;this.hw=this.view.splitHandleWidth||5},b4StartDrag:function(g,h){this.dragHeadersDisabled=this.view.headersDisabled;this.view.headersDisabled=true;var i=this.view.mainWrap.getHeight();this.marker.setHeight(i);this.marker.show();this.marker.alignTo(this.view.getHeaderCell(this.cellIndex),"tl-tl",[-2,0]);this.proxy.setHeight(i);var f=this.cm.getColumnWidth(this.cellIndex),j=Math.max(f-this.grid.minColumnWidth,0);this.resetConstraints();this.setXConstraint(j,1000);this.setYConstraint(0,0);this.minX=g-j;this.maxX=g+1000;this.startPos=g;Ext.dd.DDProxy.prototype.b4StartDrag.call(this,g,h)},allowHeaderDrag:function(b){return true},handleMouseDown:function(r){var m=this.view.findHeaderCell(r.getTarget());if(m&&this.allowHeaderDrag(r)){var e=this.view.fly(m).getXY(),p=e[0],l=r.getXY(),q=l[0],n=m.offsetWidth,o=false;if((q-p)<=this.hw){o=-1}else{if((p+n)-q<=this.hw){o=0}}if(o!==false){this.cm=this.grid.colModel;var k=this.view.getCellIndex(m);if(o==-1){if(k+o<0){return}while(this.cm.isHidden(k+o)){--o;if(k+o<0){return}}}this.cellIndex=k+o;this.split=m.dom;if(this.cm.isResizable(this.cellIndex)&&!this.cm.isFixed(this.cellIndex)){Ext.grid.GridView.SplitDragZone.superclass.handleMouseDown.apply(this,arguments)}}else{if(this.view.columnDrag){this.view.columnDrag.callHandleMouseDown(r)}}}},endDrag:function(h){this.marker.hide();var g=this.view,j=Math.max(this.minX,h.getPageX()),i=j-this.startPos,e=this.dragHeadersDisabled;g.onColumnSplitterMoved(this.cellIndex,this.cm.getColumnWidth(this.cellIndex)+i);setTimeout(function(){g.headersDisabled=e},50)},autoOffset:function(){this.setDelta(0,0)}});Ext.grid.PivotGridView=Ext.extend(Ext.grid.GridView,{colHeaderCellCls:"grid-hd-group-cell",title:"",getColumnHeaders:function(){return this.grid.topAxis.buildHeaders()},getRowHeaders:function(){return this.grid.leftAxis.buildHeaders()},renderRows:function(P,z){var O=this.grid,E=O.extractData(),D=E.length,K=this.templates,A=O.renderer,J=typeof A=="function",j=this.getCellCls,F=typeof j=="function",M=K.cell,i=K.row,I=[],C={},N="width:"+this.getGridInnerWidth()+"px;",H,B,L,x,G;P=P||0;z=Ext.isDefined(z)?z:D-1;for(x=0;x<D;x++){G=E[x];B=G.length;H=[];for(var y=0;y<B;y++){C.id=x+"-"+y;C.css=y===0?"x-grid3-cell-first ":(y==(B-1)?"x-grid3-cell-last ":"");C.attr=C.cellAttr="";C.value=G[y];if(Ext.isEmpty(C.value)){C.value="&#160;"}if(J){C.value=A(C.value)}if(F){C.css+=j(C.value)+" "}H[H.length]=M.apply(C)}I[I.length]=i.apply({tstyle:N,cols:B,cells:H.join(""),alt:""})}return I.join("")},masterTpl:new Ext.Template('<div class="x-grid3 x-pivotgrid" hidefocus="true">','<div class="x-grid3-viewport">','<div class="x-grid3-header">','<div class="x-grid3-header-title"><span>{title}</span></div>','<div class="x-grid3-header-inner">','<div class="x-grid3-header-offset" style="{ostyle}"></div>',"</div>",'<div class="x-clear"></div>',"</div>",'<div class="x-grid3-scroller">','<div class="x-grid3-row-headers"></div>','<div class="x-grid3-body" style="{bstyle}">{body}</div>','<a href="#" class="x-grid3-focus" tabIndex="-1"></a>',"</div>","</div>",'<div class="x-grid3-resize-marker">&#160;</div>','<div class="x-grid3-resize-proxy">&#160;</div>',"</div>"),initTemplates:function(){Ext.grid.PivotGridView.superclass.initTemplates.apply(this,arguments);var b=this.templates||{};if(!b.gcell){b.gcell=new Ext.XTemplate('<td class="x-grid3-hd x-grid3-gcell x-grid3-td-{id} ux-grid-hd-group-row-{row} '+this.colHeaderCellCls+'" style="{style}">','<div {tooltip} class="x-grid3-hd-inner x-grid3-hd-{id}" unselectable="on" style="{istyle}">',this.grid.enableHdMenu?'<a class="x-grid3-hd-btn" href="#"></a>':"","{value}","</div>","</td>")}this.templates=b;this.hrowRe=new RegExp("ux-grid-hd-group-row-(\\d+)","")},initElements:function(){Ext.grid.PivotGridView.superclass.initElements.apply(this,arguments);this.rowHeadersEl=new Ext.Element(this.scroller.child("div.x-grid3-row-headers"));this.headerTitleEl=new Ext.Element(this.mainHd.child("div.x-grid3-header-title"))},getGridInnerWidth:function(){var b=Ext.grid.PivotGridView.superclass.getGridInnerWidth.apply(this,arguments);return b-this.getTotalRowHeaderWidth()},getTotalRowHeaderWidth:function(){var g=this.getRowHeaders(),h=g.length,e=0,f;for(f=0;f<h;f++){e+=g[f].width}return e},getTotalColumnHeaderHeight:function(){return this.getColumnHeaders().length*21},getCellIndex:function(d){if(d){var e=d.className.match(this.colRe),f;if(e&&(f=e[1])){return parseInt(f.split("-")[1],10)}}return false},renderUI:function(){var c=this.templates,d=this.getGridInnerWidth();return c.master.apply({body:c.body.apply({rows:"&#160;"}),ostyle:"width:"+d+"px",bstyle:"width:"+d+"px"})},onLayout:function(c,d){Ext.grid.PivotGridView.superclass.onLayout.apply(this,arguments);var c=this.getGridInnerWidth();this.resizeColumnHeaders(c);this.resizeAllRows(c)},refresh:function(c){this.fireEvent("beforerefresh",this);this.grid.stopEditing(true);var d=this.renderBody();this.mainBody.update(d).setWidth(this.getGridInnerWidth());if(c===true){this.updateHeaders();this.updateHeaderSortState()}this.processRows(0,true);this.layout();this.applyEmptyText();this.fireEvent("refresh",this)},renderHeaders:Ext.emptyFn,fitColumns:Ext.emptyFn,resizeColumnHeaders:function(c){var d=this.grid.topAxis;if(d.rendered){d.el.setWidth(c)}},resizeRowHeaders:function(){var d=this.getTotalRowHeaderWidth(),c=String.format("margin-left: {0}px;",d);this.rowHeadersEl.setWidth(d);this.mainBody.applyStyles(c);Ext.fly(this.innerHd).applyStyles(c);this.headerTitleEl.setWidth(d);this.headerTitleEl.setHeight(this.getTotalColumnHeaderHeight())},resizeAllRows:function(e){var g=this.getRows(),h=g.length,f;for(f=0;f<h;f++){Ext.fly(g[f]).setWidth(e);Ext.fly(g[f]).child("table").setWidth(e)}},updateHeaders:function(){this.renderGroupRowHeaders();this.renderGroupColumnHeaders()},renderGroupRowHeaders:function(){var b=this.grid.leftAxis;this.resizeRowHeaders();b.rendered=false;b.render(this.rowHeadersEl);this.setTitle(this.title)},setTitle:function(b){this.headerTitleEl.child("span").dom.innerHTML=b},renderGroupColumnHeaders:function(){var b=this.grid.topAxis;b.rendered=false;b.render(this.innerHd.firstChild)},isMenuDisabled:function(d,c){return true}});Ext.grid.PivotAxis=Ext.extend(Ext.Component,{orientation:"horizontal",defaultHeaderWidth:80,paddingWidth:7,setDimensions:function(b){this.dimensions=b},onRender:function(d,e){var f=this.orientation=="horizontal"?this.renderHorizontalRows():this.renderVerticalRows();this.el=Ext.DomHelper.overwrite(d.dom,{tag:"table",cn:f},true)},renderHorizontalRows:function(){var k=this.buildHeaders(),j=k.length,m=[],p,l,n,o,i;for(o=0;o<j;o++){p=[];l=k[o].items;n=l.length;for(i=0;i<n;i++){p.push({tag:"td",html:l[i].header,colspan:l[i].span})}m[o]={tag:"tr",cn:p}}return m},renderVerticalRows:function(){var s=this.buildHeaders(),m=s.length,t=[],i=[],n,r,j,o,p,q;for(p=0;p<m;p++){r=s[p];o=r.width||80;n=r.items.length;for(q=0;q<n;q++){j=r.items[q];t[j.start]=t[j.start]||[];t[j.start].push({tag:"td",html:j.header,rowspan:j.span,width:Ext.isBorderBox?o:o-this.paddingWidth})}}n=t.length;for(p=0;p<n;p++){i[p]={tag:"tr",cn:t[p]}}return i},getTuples:function(){var y=new Ext.data.Store({});y.data=this.store.data.clone();y.fields=this.store.fields;var q=[],z=this.dimensions,x=z.length,s;for(s=0;s<x;s++){q.push({field:z[s].dataIndex,direction:z[s].direction||"ASC"})}y.sort(q);var v=y.data.items,o=[],r=[],i,t,w,u,p;x=v.length;for(s=0;s<x;s++){w=this.getRecordInfo(v[s]);u=w.data;t="";for(p in u){t+=u[p]+"---"}if(o.indexOf(t)==-1){o.push(t);r.push(w)}}y.destroy();return r},getRecordInfo:function(j){var n=this.dimensions,o=n.length,l={},k,p,i;for(i=0;i<o;i++){k=n[i];p=k.dataIndex;l[p]=j.get(p)}var m=function(a){return function(c){for(var b in a){if(c.get(b)!=a[b]){return false}}return true}};return{data:l,matcher:m(l)}},buildHeaders:function(){var x=this.getTuples(),w=x.length,F=this.dimensions,B,j=F.length,D=[],u,i,v,s,t,E,y,z,A,C;for(A=0;A<j;A++){B=F[A];i=[];t=0;E=0;for(C=0;C<w;C++){u=x[C];y=C==(w-1);v=u.data[B.dataIndex];z=s!=undefined&&s!=v;if(A>0&&C>0){z=z||u.data[F[A-1].dataIndex]!=x[C-1].data[F[A-1].dataIndex]}if(z){i.push({header:s,span:t,start:E});E+=t;t=0}if(y){i.push({header:v,span:t+1,start:E});E+=t;t=0}s=v;t++}D.push({items:i,width:B.width||this.defaultHeaderWidth});s=undefined}return D}});Ext.grid.HeaderDragZone=Ext.extend(Ext.dd.DragZone,{maxDragWidth:120,constructor:function(e,f,d){this.grid=e;this.view=e.getView();this.ddGroup="gridHeader"+this.grid.getGridEl().id;Ext.grid.HeaderDragZone.superclass.constructor.call(this,f);if(d){this.setHandleElId(Ext.id(f));this.setOuterHandleElId(Ext.id(d))}this.scroll=false},getDragData:function(f){var e=Ext.lib.Event.getTarget(f),d=this.view.findHeaderCell(e);if(d){return{ddel:d.firstChild,header:d}}return false},onInitDrag:function(d){this.dragHeadersDisabled=this.view.headersDisabled;this.view.headersDisabled=true;var c=this.dragData.ddel.cloneNode(true);c.id=Ext.id();c.style.width=Math.min(this.dragData.header.offsetWidth,this.maxDragWidth)+"px";this.proxy.update(c);return true},afterValidDrop:function(){this.completeDrop()},afterInvalidDrop:function(){this.completeDrop()},completeDrop:function(){var d=this.view,c=this.dragHeadersDisabled;setTimeout(function(){d.headersDisabled=c},50)}});Ext.grid.HeaderDropZone=Ext.extend(Ext.dd.DropZone,{proxyOffsets:[-4,-9],fly:Ext.Element.fly,constructor:function(e,f,d){this.grid=e;this.view=e.getView();this.proxyTop=Ext.DomHelper.append(document.body,{cls:"col-move-top",html:"&#160;"},true);this.proxyBottom=Ext.DomHelper.append(document.body,{cls:"col-move-bottom",html:"&#160;"},true);this.proxyTop.hide=this.proxyBottom.hide=function(){this.setLeftTop(-100,-100);this.setStyle("visibility","hidden")};this.ddGroup="gridHeader"+this.grid.getGridEl().id;Ext.grid.HeaderDropZone.superclass.constructor.call(this,e.getGridEl().dom)},getTargetFromEvent:function(f){var e=Ext.lib.Event.getTarget(f),d=this.view.findCellIndex(e);if(d!==false){return this.view.getHeaderCell(d)}},nextVisible:function(f){var d=this.view,e=this.grid.colModel;f=f.nextSibling;while(f){if(!e.isHidden(d.getCellIndex(f))){return f}f=f.nextSibling}return null},prevVisible:function(f){var d=this.view,e=this.grid.colModel;f=f.prevSibling;while(f){if(!e.isHidden(d.getCellIndex(f))){return f}f=f.prevSibling}return null},positionIndicator:function(o,k,l){var h=Ext.lib.Event.getPageX(l),n=Ext.lib.Dom.getRegion(k.firstChild),p,m,e=n.top+this.proxyOffsets[1];if((n.right-h)<=(n.right-n.left)/2){p=n.right+this.view.borderWidth;m="after"}else{p=n.left;m="before"}if(this.grid.colModel.isFixed(this.view.getCellIndex(k))){return false}p+=this.proxyOffsets[0];this.proxyTop.setLeftTop(p,e);this.proxyTop.show();if(!this.bottomOffset){this.bottomOffset=this.view.mainHd.getHeight()}this.proxyBottom.setLeftTop(p,e+this.proxyTop.dom.offsetHeight+this.bottomOffset);this.proxyBottom.show();return m},onNodeEnter:function(g,f,h,e){if(e.header!=g){this.positionIndicator(e.header,g,h)}},onNodeOver:function(h,e,i,j){var g=false;if(j.header!=h){g=this.positionIndicator(j.header,h,i)}if(!g){this.proxyTop.hide();this.proxyBottom.hide()}return g?this.dropAllowed:this.dropNotAllowed},onNodeOut:function(g,f,h,e){this.proxyTop.hide();this.proxyBottom.hide()},onNodeDrop:function(u,h,r,t){var s=t.header;if(s!=u){var o=this.grid.colModel,p=Ext.lib.Event.getPageX(r),v=Ext.lib.Dom.getRegion(u.firstChild),e=(v.right-p)<=((v.right-v.left)/2)?"after":"before",q=this.view.getCellIndex(s),n=this.view.getCellIndex(u);if(e=="after"){n++}if(q<n){n--}o.moveColumn(q,n);return true}return false}});Ext.grid.GridView.ColumnDragZone=Ext.extend(Ext.grid.HeaderDragZone,{constructor:function(d,c){Ext.grid.GridView.ColumnDragZone.superclass.constructor.call(this,d,c,null);this.proxy.el.addClass("x-grid3-col-dd")},handleMouseDown:function(b){},callHandleMouseDown:function(b){Ext.grid.GridView.ColumnDragZone.superclass.handleMouseDown.call(this,b)}});Ext.grid.SplitDragZone=Ext.extend(Ext.dd.DDProxy,{fly:Ext.Element.fly,constructor:function(e,f,d){this.grid=e;this.view=e.getView();this.proxy=this.view.resizeProxy;Ext.grid.SplitDragZone.superclass.constructor.call(this,f,"gridSplitters"+this.grid.getGridEl().id,{dragElId:Ext.id(this.proxy.dom),resizeFrame:false});this.setHandleElId(Ext.id(f));this.setOuterHandleElId(Ext.id(d));this.scroll=false},b4StartDrag:function(f,g){this.view.headersDisabled=true;this.proxy.setHeight(this.view.mainWrap.getHeight());var e=this.cm.getColumnWidth(this.cellIndex);var h=Math.max(e-this.grid.minColumnWidth,0);this.resetConstraints();this.setXConstraint(h,1000);this.setYConstraint(0,0);this.minX=f-h;this.maxX=f+1000;this.startPos=f;Ext.dd.DDProxy.prototype.b4StartDrag.call(this,f,g)},handleMouseDown:function(f){var d=Ext.EventObject.setEvent(f);var e=this.fly(d.getTarget());if(e.hasClass("x-grid-split")){this.cellIndex=this.view.getCellIndex(e.dom);this.split=e.dom;this.cm=this.grid.colModel;if(this.cm.isResizable(this.cellIndex)&&!this.cm.isFixed(this.cellIndex)){Ext.grid.SplitDragZone.superclass.handleMouseDown.apply(this,arguments)}}},endDrag:function(f){this.view.headersDisabled=false;var e=Math.max(this.minX,Ext.lib.Event.getPageX(f));var d=e-this.startPos;this.view.onColumnSplitterMoved(this.cellIndex,this.cm.getColumnWidth(this.cellIndex)+d)},autoOffset:function(){this.setDelta(0,0)}});Ext.grid.GridDragZone=function(c,d){this.view=c.getView();Ext.grid.GridDragZone.superclass.constructor.call(this,this.view.mainBody.dom,d);this.scroll=false;this.grid=c;this.ddel=document.createElement("div");this.ddel.className="x-grid-dd-wrap"};Ext.extend(Ext.grid.GridDragZone,Ext.dd.DragZone,{ddGroup:"GridDD",getDragData:function(e){var f=Ext.lib.Event.getTarget(e);var g=this.view.findRowIndex(f);if(g!==false){var h=this.grid.selModel;if(!h.isSelected(g)||e.hasModifier()){h.handleMouseDown(this.grid,g,e)}return{grid:this.grid,ddel:this.ddel,rowIndex:g,selections:h.getSelections()}}return false},onInitDrag:function(c){var d=this.dragData;this.ddel.innerHTML=this.grid.getDragDropText();this.proxy.update(this.ddel)},afterRepair:function(){this.dragging=false},getRepairXY:function(c,d){return false},onEndDrag:function(d,c){},onValidDrop:function(e,d,f){this.hideProxy()},beforeInvalidDrop:function(d,c){}});Ext.grid.ColumnModel=Ext.extend(Ext.util.Observable,{defaultWidth:100,defaultSortable:false,constructor:function(b){if(b.columns){Ext.apply(this,b);this.setConfig(b.columns,true)}else{this.setConfig(b,true)}this.addEvents("widthchange","headerchange","hiddenchange","columnmoved","configchange");Ext.grid.ColumnModel.superclass.constructor.call(this)},getColumnId:function(b){return this.config[b].id},getColumnAt:function(b){return this.config[b]},setConfig:function(l,c){var k,i,h;if(!c){delete this.totalWidth;for(k=0,h=this.config.length;k<h;k++){i=this.config[k];if(i.setEditor){i.setEditor(null)}}}this.defaults=Ext.apply({width:this.defaultWidth,sortable:this.defaultSortable},this.defaults);this.config=l;this.lookup={};for(k=0,h=l.length;k<h;k++){i=Ext.applyIf(l[k],this.defaults);if(Ext.isEmpty(i.id)){i.id=k}if(!i.isColumn){var j=Ext.grid.Column.types[i.xtype||"gridcolumn"];i=new j(i);l[k]=i}this.lookup[i.id]=i}if(!c){this.fireEvent("configchange",this)}},getColumnById:function(b){return this.lookup[b]},getIndexById:function(f){for(var d=0,e=this.config.length;d<e;d++){if(this.config[d].id==f){return d}}return -1},moveColumn:function(g,c){var f=this.config,h=f[g];f.splice(g,1);f.splice(c,0,h);this.dataMap=null;this.fireEvent("columnmoved",this,g,c)},getColumnCount:function(c){var h=this.config.length,g=0,f;if(c===true){for(f=0;f<h;f++){if(!this.isHidden(f)){g++}}return g}return h},getColumnsBy:function(l,m){var c=this.config,k=c.length,i=[],n,j;for(n=0;n<k;n++){j=c[n];if(l.call(m||this,j,n)===true){i[i.length]=j}}return i},isSortable:function(b){return !!this.config[b].sortable},isMenuDisabled:function(b){return !!this.config[b].menuDisabled},getRenderer:function(b){return this.config[b].renderer||Ext.grid.ColumnModel.defaultRenderer},getRendererScope:function(b){return this.config[b].scope},setRenderer:function(d,c){this.config[d].renderer=c},getColumnWidth:function(d){var c=this.config[d].width;if(typeof c!="number"){c=this.defaultWidth}return c},setColumnWidth:function(d,f,e){this.config[d].width=f;this.totalWidth=null;if(!e){this.fireEvent("widthchange",this,d,f)}},getTotalWidth:function(d){if(!this.totalWidth){this.totalWidth=0;for(var f=0,e=this.config.length;f<e;f++){if(d||!this.isHidden(f)){this.totalWidth+=this.getColumnWidth(f)}}}return this.totalWidth},getColumnHeader:function(b){return this.config[b].header},setColumnHeader:function(d,c){this.config[d].header=c;this.fireEvent("headerchange",this,d,c)},getColumnTooltip:function(b){return this.config[b].tooltip},setColumnTooltip:function(d,c){this.config[d].tooltip=c},getDataIndex:function(b){return this.config[b].dataIndex},setDataIndex:function(d,c){this.config[d].dataIndex=c},findColumnIndex:function(h){var g=this.config;for(var c=0,f=g.length;c<f;c++){if(g[c].dataIndex==h){return c}}return -1},isCellEditable:function(c,g){var h=this.config[c],f=h.editable;return !!(f||(!Ext.isDefined(f)&&h.editor))},getCellEditor:function(d,c){return this.config[d].getCellEditor(c)},setEditable:function(d,c){this.config[d].editable=c},isHidden:function(b){return !!this.config[b].hidden},isFixed:function(b){return !!this.config[b].fixed},isResizable:function(b){return b>=0&&this.config[b].resizable!==false&&this.config[b].fixed!==true},setHidden:function(e,c){var f=this.config[e];if(f.hidden!==c){f.hidden=c;this.totalWidth=null;this.fireEvent("hiddenchange",this,e,c)}},setEditor:function(d,c){this.config[d].setEditor(c)},destroy:function(){var c=this.config.length,d=0;for(;d<c;d++){this.config[d].destroy()}delete this.config;delete this.lookup;this.purgeListeners()},setState:function(d,c){c=Ext.applyIf(c,this.defaults);Ext.apply(this.config[d],c)}});Ext.grid.ColumnModel.defaultRenderer=function(b){if(typeof b=="string"&&b.length<1){return"&#160;"}return b};Ext.grid.AbstractSelectionModel=Ext.extend(Ext.util.Observable,{constructor:function(){this.locked=false;Ext.grid.AbstractSelectionModel.superclass.constructor.call(this)},init:function(b){this.grid=b;if(this.lockOnInit){delete this.lockOnInit;this.locked=false;this.lock()}this.initEvents()},lock:function(){if(!this.locked){this.locked=true;var b=this.grid;if(b){b.getView().on({scope:this,beforerefresh:this.sortUnLock,refresh:this.sortLock})}else{this.lockOnInit=true}}},sortLock:function(){this.locked=true},sortUnLock:function(){this.locked=false},unlock:function(){if(this.locked){this.locked=false;var d=this.grid,c;if(d){c=d.getView();c.un("beforerefresh",this.sortUnLock,this);c.un("refresh",this.sortLock,this)}else{delete this.lockOnInit}}},isLocked:function(){return this.locked},destroy:function(){this.unlock();this.purgeListeners()}});Ext.grid.RowSelectionModel=Ext.extend(Ext.grid.AbstractSelectionModel,{singleSelect:false,constructor:function(b){Ext.apply(this,b);this.selections=new Ext.util.MixedCollection(false,function(a){return a.id});this.last=false;this.lastActive=false;this.addEvents("selectionchange","beforerowselect","rowselect","rowdeselect");Ext.grid.RowSelectionModel.superclass.constructor.call(this)},initEvents:function(){if(!this.grid.enableDragDrop&&!this.grid.enableDrag){this.grid.on("rowmousedown",this.handleMouseDown,this)}this.rowNav=new Ext.KeyNav(this.grid.getGridEl(),{up:this.onKeyPress,down:this.onKeyPress,scope:this});this.grid.getView().on({scope:this,refresh:this.onRefresh,rowupdated:this.onRowUpdated,rowremoved:this.onRemove})},onKeyPress:function(j,e){var h=e=="up",i=h?"selectPrevious":"selectNext",k=h?-1:1,l;if(!j.shiftKey||this.singleSelect){this[i](false)}else{if(this.last!==false&&this.lastActive!==false){l=this.last;this.selectRange(this.last,this.lastActive+k);this.grid.getView().focusRow(this.lastActive);if(l!==false){this.last=l}}else{this.selectFirstRow()}}},onRefresh:function(){var i=this.grid.store,k=this.getSelections(),l=0,h=k.length,g,j;this.silent=true;this.clearSelections(true);for(;l<h;l++){j=k[l];if((g=i.indexOfId(j.id))!=-1){this.selectRow(g,true)}}if(k.length!=this.selections.getCount()){this.fireEvent("selectionchange",this)}this.silent=false},onRemove:function(e,d,f){if(this.selections.remove(f)!==false){this.fireEvent("selectionchange",this)}},onRowUpdated:function(e,d,f){if(this.isSelected(f)){e.onRowSelect(d)}},selectRecords:function(f,h){if(!h){this.clearSelections()}var i=this.grid.store,j=0,g=f.length;for(;j<g;j++){this.selectRow(i.indexOf(f[j]),true)}},getCount:function(){return this.selections.length},selectFirstRow:function(){this.selectRow(0)},selectLastRow:function(b){this.selectRow(this.grid.store.getCount()-1,b)},selectNext:function(b){if(this.hasNext()){this.selectRow(this.last+1,b);this.grid.getView().focusRow(this.last);return true}return false},selectPrevious:function(b){if(this.hasPrevious()){this.selectRow(this.last-1,b);this.grid.getView().focusRow(this.last);return true}return false},hasNext:function(){return this.last!==false&&(this.last+1)<this.grid.store.getCount()},hasPrevious:function(){return !!this.last},getSelections:function(){return[].concat(this.selections.items)},getSelected:function(){return this.selections.itemAt(0)},each:function(h,i){var j=this.getSelections(),f=0,g=j.length;for(;f<g;f++){if(h.call(i||this,j[f],f)===false){return false}}return true},clearSelections:function(e){if(this.isLocked()){return}if(e!==true){var f=this.grid.store,d=this.selections;d.each(function(a){this.deselectRow(f.indexOfId(a.id))},this);d.clear()}else{this.selections.clear()}this.last=false},selectAll:function(){if(this.isLocked()){return}this.selections.clear();for(var c=0,d=this.grid.store.getCount();c<d;c++){this.selectRow(c,true)}},hasSelection:function(){return this.selections.length>0},isSelected:function(d){var c=Ext.isNumber(d)?this.grid.store.getAt(d):d;return(c&&this.selections.key(c.id)?true:false)},isIdSelected:function(b){return(this.selections.key(b)?true:false)},handleMouseDown:function(k,i,j){if(j.button!==0||this.isLocked()){return}var g=this.grid.getView();if(j.shiftKey&&!this.singleSelect&&this.last!==false){var l=this.last;this.selectRange(l,i,j.ctrlKey);this.last=l;g.focusRow(i)}else{var e=this.isSelected(i);if(j.ctrlKey&&e){this.deselectRow(i)}else{if(!e||this.getCount()>1){this.selectRow(i,j.ctrlKey||j.shiftKey);g.focusRow(i)}}}},selectRows:function(h,g){if(!g){this.clearSelections()}for(var e=0,f=h.length;e<f;e++){this.selectRow(h[e],true)}},selectRange:function(e,f,g){var h;if(this.isLocked()){return}if(!g){this.clearSelections()}if(e<=f){for(h=e;h<=f;h++){this.selectRow(h,true)}}else{for(h=e;h>=f;h--){this.selectRow(h,true)}}},deselectRange:function(h,e,f){if(this.isLocked()){return}for(var g=h;g<=e;g++){this.deselectRow(g,f)}},selectRow:function(e,g,f){if(this.isLocked()||(e<0||e>=this.grid.store.getCount())||(g&&this.isSelected(e))){return}var h=this.grid.store.getAt(e);if(h&&this.fireEvent("beforerowselect",this,e,g,h)!==false){if(!g||this.singleSelect){this.clearSelections()}this.selections.add(h);this.last=this.lastActive=e;if(!f){this.grid.getView().onRowSelect(e)}if(!this.silent){this.fireEvent("rowselect",this,e,h);this.fireEvent("selectionchange",this)}}},deselectRow:function(d,e){if(this.isLocked()){return}if(this.last==d){this.last=false}if(this.lastActive==d){this.lastActive=false}var f=this.grid.store.getAt(d);if(f){this.selections.remove(f);if(!e){this.grid.getView().onRowDeselect(d)}this.fireEvent("rowdeselect",this,d,f);this.fireEvent("selectionchange",this)}},acceptsNav:function(f,d,e){return !e.isHidden(d)&&e.isCellEditable(d,f)},onEditorKey:function(g,p){var t=p.getKey(),s,r=this.grid,c=r.lastEdit,q=r.activeEditor,u=p.shiftKey,e,c,v,k;if(t==p.TAB){p.stopEvent();q.completeEdit();if(u){s=r.walkCells(q.row,q.col-1,-1,this.acceptsNav,this)}else{s=r.walkCells(q.row,q.col+1,1,this.acceptsNav,this)}}else{if(t==p.ENTER){if(this.moveEditorOnEnter!==false){if(u){s=r.walkCells(c.row-1,c.col,-1,this.acceptsNav,this)}else{s=r.walkCells(c.row+1,c.col,1,this.acceptsNav,this)}}}}if(s){v=s[0];k=s[1];this.onEditorSelect(v,c.row);if(r.isEditor&&r.editing){e=r.activeEditor;if(e&&e.field.triggerBlur){e.field.triggerBlur()}}r.startEditing(v,k)}},onEditorSelect:function(c,d){if(d!=c){this.selectRow(c)}},destroy:function(){Ext.destroy(this.rowNav);this.rowNav=null;Ext.grid.RowSelectionModel.superclass.destroy.call(this)}});Ext.grid.Column=Ext.extend(Ext.util.Observable,{isColumn:true,constructor:function(c){Ext.apply(this,c);if(Ext.isString(this.renderer)){this.renderer=Ext.util.Format[this.renderer]}else{if(Ext.isObject(this.renderer)){this.scope=this.renderer.scope;this.renderer=this.renderer.fn}}if(!this.scope){this.scope=this}var d=this.editor;delete this.editor;this.setEditor(d);this.addEvents("click","contextmenu","dblclick","mousedown");Ext.grid.Column.superclass.constructor.call(this)},processEvent:function(e,i,j,h,g){return this.fireEvent(e,this,j,h,i)},destroy:function(){if(this.setEditor){this.setEditor(null)}this.purgeListeners()},renderer:function(b){return b},getEditor:function(b){return this.editable!==false?this.editor:null},setEditor:function(c){var d=this.editor;if(d){if(d.gridEditor){d.gridEditor.destroy();delete d.gridEditor}else{d.destroy()}}this.editor=null;if(c){if(!c.isXType){c=Ext.create(c,"textfield")}this.editor=c}},getCellEditor:function(c){var d=this.getEditor(c);if(d){if(!d.startEdit){if(!d.gridEditor){d.gridEditor=new Ext.grid.GridEditor(d)}d=d.gridEditor}}return d}});Ext.grid.BooleanColumn=Ext.extend(Ext.grid.Column,{trueText:"true",falseText:"false",undefinedText:"&#160;",constructor:function(f){Ext.grid.BooleanColumn.superclass.constructor.call(this,f);var h=this.trueText,g=this.falseText,e=this.undefinedText;this.renderer=function(a){if(a===undefined){return e}if(!a||a==="false"){return g}return h}}});Ext.grid.NumberColumn=Ext.extend(Ext.grid.Column,{format:"0,000.00",constructor:function(b){Ext.grid.NumberColumn.superclass.constructor.call(this,b);this.renderer=Ext.util.Format.numberRenderer(this.format)}});Ext.grid.DateColumn=Ext.extend(Ext.grid.Column,{format:"m/d/Y",constructor:function(b){Ext.grid.DateColumn.superclass.constructor.call(this,b);this.renderer=Ext.util.Format.dateRenderer(this.format)}});Ext.grid.TemplateColumn=Ext.extend(Ext.grid.Column,{constructor:function(d){Ext.grid.TemplateColumn.superclass.constructor.call(this,d);var c=(!Ext.isPrimitive(this.tpl)&&this.tpl.compile)?this.tpl:new Ext.XTemplate(this.tpl);this.renderer=function(b,a,f){return c.apply(f.data)};this.tpl=c}});Ext.grid.ActionColumn=Ext.extend(Ext.grid.Column,{header:"&#160;",actionIdRe:/x-action-col-(\d+)/,altText:"",constructor:function(g){var i=this,l=g.items||(i.items=[i]),h=l.length,k,j;Ext.grid.ActionColumn.superclass.constructor.call(i,g);i.renderer=function(b,a){b=Ext.isFunction(g.renderer)?g.renderer.apply(this,arguments)||"":"";a.css+=" x-action-col-cell";for(k=0;k<h;k++){j=l[k];b+='<img alt="'+(j.altText||i.altText)+'" src="'+(j.icon||Ext.BLANK_IMAGE_URL)+'" class="x-action-col-icon x-action-col-'+String(k)+" "+(j.iconCls||"")+" "+(Ext.isFunction(j.getClass)?j.getClass.apply(j.scope||this.scope||this,arguments):"")+'"'+((j.tooltip)?' ext:qtip="'+j.tooltip+'"':"")+" />"}return b}},destroy:function(){delete this.items;delete this.renderer;return Ext.grid.ActionColumn.superclass.destroy.apply(this,arguments)},processEvent:function(p,l,o,k,e){var j=l.getTarget().className.match(this.actionIdRe),m,n;if(j&&(m=this.items[parseInt(j[1],10)])){if(p=="click"){(n=m.handler||this.handler)&&n.call(m.scope||this.scope||this,o,k,e,m,l)}else{if((p=="mousedown")&&(m.stopSelection!==false)){return false}}}return Ext.grid.ActionColumn.superclass.processEvent.apply(this,arguments)}});Ext.grid.Column.types={gridcolumn:Ext.grid.Column,booleancolumn:Ext.grid.BooleanColumn,numbercolumn:Ext.grid.NumberColumn,datecolumn:Ext.grid.DateColumn,templatecolumn:Ext.grid.TemplateColumn,actioncolumn:Ext.grid.ActionColumn};Ext.grid.RowNumberer=Ext.extend(Object,{header:"",width:23,sortable:false,constructor:function(b){Ext.apply(this,b);if(this.rowspan){this.renderer=this.renderer.createDelegate(this)}},fixed:true,hideable:false,menuDisabled:true,dataIndex:"",id:"numberer",rowspan:undefined,renderer:function(e,h,f,g){if(this.rowspan){h.cellAttr='rowspan="'+this.rowspan+'"'}return g+1}});Ext.grid.CheckboxSelectionModel=Ext.extend(Ext.grid.RowSelectionModel,{header:'<div class="x-grid3-hd-checker">&#160;</div>',width:20,sortable:false,menuDisabled:true,fixed:true,hideable:false,dataIndex:"",id:"checker",isColumn:true,constructor:function(){Ext.grid.CheckboxSelectionModel.superclass.constructor.apply(this,arguments);if(this.checkOnly){this.handleMouseDown=Ext.emptyFn}},initEvents:function(){Ext.grid.CheckboxSelectionModel.superclass.initEvents.call(this);this.grid.on("render",function(){Ext.fly(this.grid.getView().innerHd).on("mousedown",this.onHdMouseDown,this)},this)},processEvent:function(e,i,j,h,g){if(e=="mousedown"){this.onMouseDown(i,i.getTarget());return false}else{return Ext.grid.Column.prototype.processEvent.apply(this,arguments)}},onMouseDown:function(h,e){if(h.button===0&&e.className=="x-grid3-row-checker"){h.stopEvent();var g=h.getTarget(".x-grid3-row");if(g){var f=g.rowIndex;if(this.isSelected(f)){this.deselectRow(f)}else{this.selectRow(f,true);this.grid.getView().focusRow(f)}}}},onHdMouseDown:function(h,f){if(f.className=="x-grid3-hd-checker"){h.stopEvent();var e=Ext.fly(f.parentNode);var g=e.hasClass("x-grid3-hd-checker-on");if(g){e.removeClass("x-grid3-hd-checker-on");this.clearSelections()}else{e.addClass("x-grid3-hd-checker-on");this.selectAll()}}},renderer:function(d,f,e){return'<div class="x-grid3-row-checker">&#160;</div>'},onEditorSelect:function(c,d){if(d!=c&&!this.checkOnly){this.selectRow(c)}}});(function(){var a=Ext.Toolbar;Ext.ux.SimplePagingToolbar=Ext.extend(Ext.Toolbar,{pageSize:20,pageIndex:0,recordCount:0,pageCount:0,displayMsg:"Displaying {0} - {1} of {2}",emptyMsg:"No data to display",beforePageText:"Page",afterPageText:"of {0}",firstText:"First Page",prevText:"Previous Page",nextText:"Next Page",lastText:"Last Page",initComponent:function(){var c=[this.first=new a.Button({tooltip:this.firstText,overflowText:this.firstText,iconCls:"x-tbar-page-first",disabled:true,handler:this.onClick,scope:this}),this.prev=new a.Button({tooltip:this.prevText,overflowText:this.prevText,iconCls:"x-tbar-page-prev",disabled:true,handler:this.onClick,scope:this}),"-",this.beforePageText,this.inputItem=new Ext.form.NumberField({cls:"x-tbar-page-number",allowDecimals:false,allowNegative:false,enableKeyEvents:true,selectOnFocus:true,submitValue:false,listeners:{scope:this,keydown:this.onPagingKeyDown,blur:this.onPagingBlur}}),this.afterTextItem=new a.TextItem({text:String.format(this.afterPageText,1)}),"-",this.next=new a.Button({tooltip:this.nextText,iconCls:"x-tbar-page-next",disabled:true,handler:this.onClick,scope:this}),this.last=new a.Button({tooltip:this.lastText,iconCls:"x-tbar-page-last",disabled:true,handler:this.onClick,scope:this})];var b=this.items||this.buttons||[];if(this.prependButtons){this.items=b.concat(c)}else{this.items=c.concat(b)}delete this.buttons;if(this.displayInfo){this.items.push("->");this.items.push(this.displayItem=new a.TextItem({}))}Ext.ux.SimplePagingToolbar.superclass.initComponent.call(this);this.on("afterlayout",this.onFirstLayout,this,{single:true})},load:function(b){Ext.apply(this,b);this.onLoad()},onFirstLayout:function(){this.onLoad()},onLoad:function(){var e=this.getPageData(),b=e.activePage,c=e.pages;this.afterTextItem.setText(String.format(this.afterPageText,e.pages));this.inputItem.setValue(b);this.first.setDisabled(b==1);this.prev.setDisabled(b==1);this.next.setDisabled(b==c);this.last.setDisabled(b==c);this.updateInfo()},updateInfo:function(){if(this.displayItem){var c="";if(this.recordCount==0){c=this.emptyMsg}else{var b=(this.pageIndex+1)*this.pageSize;b=b<this.recordCount?b:this.recordCount;c=String.format(this.displayMsg,this.pageIndex*this.pageSize+1,b,this.recordCount)}this.displayItem.setText(c)}},getPageData:function(){return{total:this.recordCount,activePage:this.pageIndex+1,pages:this.pageCount<=0?1:this.pageCount}},readPage:function(e){var b=this.inputItem.getValue(),c;if(!b||isNaN(c=parseInt(b,10))){this.inputItem.setValue(e.activePage);return false}return c},onPagingFocus:function(){this.inputItem.select()},onPagingBlur:function(b){this.inputItem.setValue(this.getPageData().activePage)},onPagingKeyDown:function(h,g){var c=g.getKey(),i=this.getPageData(),f;if(c==g.RETURN){g.stopEvent();f=this.readPage(i);if(f!==false){f=Math.min(Math.max(1,f),i.pages)-1;this.onLoadPage(f)}}else{if(c==g.HOME||c==g.END){g.stopEvent();f=c==g.HOME?1:i.pages;h.setValue(f)}else{if(c==g.UP||c==g.PAGEUP||c==g.DOWN||c==g.PAGEDOWN){g.stopEvent();if((f=this.readPage(i))){var b=g.shiftKey?10:1;if(c==g.DOWN||c==g.PAGEDOWN){b*=-1}f+=b;if(f>=1&f<=i.pages){h.setValue(f)}}}}}},onClick:function(b){switch(b){case this.first:this.onLoadPage(0);break;case this.prev:var c=this.pageIndex-1;c=c<0?0:c;this.onLoadPage(c);break;case this.next:var c=this.pageIndex+1;c=c>=this.pageCount?this.pageCount-1:c;this.onLoadPage(c);break;case this.last:this.onLoadPage(this.pageCount-1);break}},onLoadPage:function(b){},onDestroy:function(){Ext.ux.SimplePagingToolbar.superclass.onDestroy.call(this)}})})();Ext.reg("ux-simplepaging",Ext.ux.SimplePagingToolbar);
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.ns("Ext.ux.grid");Ext.ux.grid.RowExpander=Ext.extend(Ext.util.Observable,{expandOnEnter:true,expandOnDblClick:true,header:"",width:20,sortable:false,fixed:true,hideable:false,menuDisabled:true,dataIndex:"",id:"expander",lazyRender:true,enableCaching:true,constructor:function(a){Ext.apply(this,a);this.addEvents({beforeexpand:true,expand:true,beforecollapse:true,collapse:true});Ext.ux.grid.RowExpander.superclass.constructor.call(this);if(this.tpl){if(typeof this.tpl=="string"){this.tpl=new Ext.Template(this.tpl)}this.tpl.compile()}this.state={};this.bodyContent={}},getRowClass:function(a,e,d,c){d.cols=d.cols-1;var b=this.bodyContent[a.id];if(!b&&!this.lazyRender){b=this.getBodyContent(a,e)}if(b){d.body=b}return this.state[a.id]?"x-grid3-row-expanded":"x-grid3-row-collapsed"},init:function(b){this.grid=b;var a=b.getView();a.getRowClass=this.getRowClass.createDelegate(this);a.enableRowBody=true;b.on("render",this.onRender,this);b.on("destroy",this.onDestroy,this)},onRender:function(){var a=this.grid;var b=a.getView().mainBody;b.on("mousedown",this.onMouseDown,this,{delegate:".x-grid3-row-expander"});if(this.expandOnEnter){this.keyNav=new Ext.KeyNav(this.grid.getGridEl(),{enter:this.onEnter,scope:this})}if(this.expandOnDblClick){a.on("rowdblclick",this.onRowDblClick,this)}},onDestroy:function(){if(this.keyNav){this.keyNav.disable();delete this.keyNav}var a=this.grid.getView().mainBody;if(a){a.un("mousedown",this.onMouseDown,this)}},onRowDblClick:function(a,b,c){this.toggleRow(b)},onEnter:function(h){var f=this.grid;var j=f.getSelectionModel();var b=j.getSelections();for(var c=0,a=b.length;c<a;c++){var d=f.getStore().indexOf(b[c]);this.toggleRow(d)}},getBodyContent:function(a,b){if(!this.enableCaching){return this.tpl.apply(a.data)}var c=this.bodyContent[a.id];if(!c){c=this.tpl.apply(a.data);this.bodyContent[a.id]=c}return c},onMouseDown:function(b,a){b.stopEvent();var c=b.getTarget(".x-grid3-row");this.toggleRow(c)},renderer:function(b,c,a){c.cellAttr='rowspan="2"';return'<div class="x-grid3-row-expander">&#160;</div>'},beforeExpand:function(b,a,c){if(this.fireEvent("beforeexpand",this,b,a,c)!==false){if(this.tpl&&this.lazyRender){a.innerHTML=this.getBodyContent(b,c)}return true}else{return false}},toggleRow:function(a){if(typeof a=="number"){a=this.grid.view.getRow(a)}this[Ext.fly(a).hasClass("x-grid3-row-collapsed")?"expandRow":"collapseRow"](a)},expandRow:function(c){if(typeof c=="number"){c=this.grid.view.getRow(c)}var b=this.grid.store.getAt(c.rowIndex);var a=Ext.DomQuery.selectNode("tr:nth(2) div.x-grid3-row-body",c);if(this.beforeExpand(b,a,c.rowIndex)){this.state[b.id]=true;Ext.fly(c).replaceClass("x-grid3-row-collapsed","x-grid3-row-expanded");this.fireEvent("expand",this,b,a,c.rowIndex)}},collapseRow:function(c){if(typeof c=="number"){c=this.grid.view.getRow(c)}var b=this.grid.store.getAt(c.rowIndex);var a=Ext.fly(c).child("tr:nth(1) div.x-grid3-row-body",true);if(this.fireEvent("beforecollapse",this,b,a,c.rowIndex)!==false){this.state[b.id]=false;Ext.fly(c).replaceClass("x-grid3-row-expanded","x-grid3-row-collapsed");this.fireEvent("collapse",this,b,a,c.rowIndex)}}});Ext.preg("rowexpander",Ext.ux.grid.RowExpander);Ext.grid.RowExpander=Ext.ux.grid.RowExpander;
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.ns("Ext.ux.grid");Ext.ux.grid.ColumnHeaderGroup=Ext.extend(Ext.util.Observable,{constructor:function(a){this.config=a},init:function(a){Ext.applyIf(a.colModel,this.config);Ext.apply(a.getView(),this.viewConfig)},viewConfig:{initTemplates:function(){this.constructor.prototype.initTemplates.apply(this,arguments);var a=this.templates||{};if(!a.gcell){a.gcell=new Ext.XTemplate('<td class="x-grid3-hd x-grid3-gcell x-grid3-td-{id} ux-grid-hd-group-row-{row} {cls}" style="{style}">','<div {tooltip} class="x-grid3-hd-inner x-grid3-hd-{id}" unselectable="on" style="{istyle}">',this.grid.enableHdMenu?'<a class="x-grid3-hd-btn" href="#"></a>':"","{value}</div></td>")}this.templates=a;this.hrowRe=new RegExp("ux-grid-hd-group-row-(\\d+)","")},renderHeaders:function(){var h=this.templates,d=[],l=this.cm,p=l.rows,j="width:"+this.getTotalWidth()+";";for(var o=0,k=p.length;o<k;o++){var a=p[o],n=[];for(var f=0,e=0,g=a.length;f<g;f++){var m=a[f];m.colspan=m.colspan||1;var b=this.getColumnId(m.dataIndex?l.findColumnIndex(m.dataIndex):e),c=Ext.ux.grid.ColumnHeaderGroup.prototype.getGroupStyle.call(this,m,e);n[f]=h.gcell.apply({cls:"ux-grid-hd-group-cell",id:b,row:o,style:"width:"+c.width+";"+(c.hidden?"display:none;":"")+(m.align?"text-align:"+m.align+";":""),tooltip:m.tooltip?(Ext.QuickTips.isEnabled()?"ext:qtip":"title")+'="'+m.tooltip+'"':"",istyle:m.align=="right"?"padding-right:16px":"",btn:this.grid.enableHdMenu&&m.header,value:m.header||"&nbsp;"});e+=m.colspan}d[o]=h.header.apply({tstyle:j,cells:n.join("")})}d.push(this.constructor.prototype.renderHeaders.apply(this,arguments));return d.join("")},onColumnWidthUpdated:function(){this.constructor.prototype.onColumnWidthUpdated.apply(this,arguments);Ext.ux.grid.ColumnHeaderGroup.prototype.updateGroupStyles.call(this)},onAllColumnWidthsUpdated:function(){this.constructor.prototype.onAllColumnWidthsUpdated.apply(this,arguments);Ext.ux.grid.ColumnHeaderGroup.prototype.updateGroupStyles.call(this)},onColumnHiddenUpdated:function(){this.constructor.prototype.onColumnHiddenUpdated.apply(this,arguments);Ext.ux.grid.ColumnHeaderGroup.prototype.updateGroupStyles.call(this)},getHeaderCell:function(a){return this.mainHd.query(this.cellSelector)[a]},findHeaderCell:function(a){return a?this.fly(a).findParent("td.x-grid3-hd",this.cellSelectorDepth):false},findHeaderIndex:function(b){var a=this.findHeaderCell(b);return a?this.getCellIndex(a):false},updateSortIcon:function(b,a){var d=this.sortClasses,c=this.mainHd.select(this.cellSelector).removeClass(d);c.item(b).addClass(d[a=="DESC"?1:0])},handleHdDown:function(h,d){var f=Ext.get(d);if(f.hasClass("x-grid3-hd-btn")){h.stopEvent();var g=this.findHeaderCell(d);Ext.fly(g).addClass("x-grid3-hd-menu-open");var c=this.getCellIndex(g);this.hdCtxIndex=c;var b=this.hmenu.items,a=this.cm;b.get("asc").setDisabled(!a.isSortable(c));b.get("desc").setDisabled(!a.isSortable(c));this.hmenu.on("hide",function(){Ext.fly(g).removeClass("x-grid3-hd-menu-open")},this,{single:true});this.hmenu.show(d,"tl-bl?")}else{if(f.hasClass("ux-grid-hd-group-cell")||Ext.fly(d).up(".ux-grid-hd-group-cell")){h.stopEvent()}}},handleHdMove:function(h,d){var g=this.findHeaderCell(this.activeHdRef);if(g&&!this.headersDisabled&&!Ext.fly(g).hasClass("ux-grid-hd-group-cell")){var b=this.splitHandleWidth||5,f=this.activeHdRegion,a=h.getPageX(),c=g.style,i="";if(this.grid.enableColumnResize!==false){if(a-f.left<=b&&this.cm.isResizable(this.activeHdIndex-1)){i=Ext.isAir?"move":Ext.isWebKit?"e-resize":"col-resize"}else{if(f.right-a<=(!this.activeHdBtn?b:2)&&this.cm.isResizable(this.activeHdIndex)){i=Ext.isAir?"move":Ext.isWebKit?"w-resize":"col-resize"}}}c.cursor=i}},handleHdOver:function(d,a){var c=this.findHeaderCell(a);if(c&&!this.headersDisabled){this.activeHdRef=a;this.activeHdIndex=this.getCellIndex(c);var b=this.fly(c);this.activeHdRegion=b.getRegion();if(!(this.cm.isMenuDisabled(this.activeHdIndex)||b.hasClass("ux-grid-hd-group-cell"))){b.addClass("x-grid3-hd-over");this.activeHdBtn=b.child(".x-grid3-hd-btn");if(this.activeHdBtn){this.activeHdBtn.dom.style.height=(c.firstChild.offsetHeight-1)+"px"}}}},handleHdOut:function(c,a){var b=this.findHeaderCell(a);if(b&&(!Ext.isIE||!c.within(b,true))){this.activeHdRef=null;this.fly(b).removeClass("x-grid3-hd-over");b.style.cursor=""}},handleHdMenuClick:function(q){var l=this.hdCtxIndex,o=this.cm,d=this.ds,b=q.getItemId();switch(b){case"asc":d.sort(o.getDataIndex(l),"ASC");break;case"desc":d.sort(o.getDataIndex(l),"DESC");break;default:if(b.substr(0,6)=="group-"){var h=b.split("-"),s=parseInt(h[1],10),e=parseInt(h[2],10),a=this.cm.rows[s],p,f=0;for(var h=0,k=a.length;h<k;h++){p=a[h];if(e>=f&&e<f+p.colspan){break}f+=p.colspan}if(q.checked){var m=o.getColumnsBy(this.isHideableColumn,this).length;for(var h=f,k=f+p.colspan;h<k;h++){if(!o.isHidden(h)){m--}}if(m<1){this.onDenyColumnHide();return false}}for(var h=f,k=f+p.colspan;h<k;h++){if(o.config[h].fixed!==true&&o.config[h].hideable!==false){o.setHidden(h,q.checked)}}}else{if(b.substr(0,4)=="col-"){l=o.getIndexById(b.substr(4));if(l!=-1){if(q.checked&&o.getColumnsBy(this.isHideableColumn,this).length<=1){this.onDenyColumnHide();return false}o.setHidden(l,q.checked)}}}if(b.substr(0,6)=="group-"||b.substr(0,4)=="col-"){q.checked=!q.checked;if(q.menu){var j=function(i){i.items.each(function(r){if(!r.disabled){r.setChecked(q.checked,false);if(r.menu){j(r.menu)}}})};j(q.menu)}var g=q,c;while(g=g.parentMenu){if(!g.parentMenu||!(c=g.parentMenu.items.get(g.getItemId()))||!c.setChecked){break}var n=g.items.findIndexBy(function(i){return i.checked})>=0;c.setChecked(n,true)}q.checked=!q.checked}}return true},beforeColMenuShow:function(){var h=this.cm,j=this.cm.rows;this.colMenu.removeAll();for(var d=0,m=h.getColumnCount();d<m;d++){var a=this.colMenu,x=h.getColumnHeader(d),l=[];if(h.config[d].fixed!==true&&h.config[d].hideable!==false){for(var e=0,s=j.length;e<s;e++){var n=j[e],g,p=0;for(var t=0,u=n.length;t<u;t++){g=n[t];if(d>=p&&d<p+g.colspan){break}p+=g.colspan}if(g&&g.header){if(h.hierarchicalColMenu){var o="group-"+e+"-"+p,v=a.items?a.getComponent(o):null,k=v?v.menu:null;if(!k){k=new Ext.menu.Menu({itemId:o});k.on("itemclick",this.handleHdMenuClick,this);var f=false,b=true;for(var w=p,q=p+g.colspan;w<q;w++){if(!h.isHidden(w)){f=true}if(h.config[w].hideable!==false){b=false}}a.add({itemId:o,text:g.header,menu:k,hideOnClick:false,checked:f,disabled:b})}a=k}else{l.push(g.header)}}}l.push(x);a.add(new Ext.menu.CheckItem({itemId:"col-"+h.getColumnId(d),text:l.join(" "),checked:!h.isHidden(d),hideOnClick:false,disabled:h.config[d].hideable===false}))}}},afterRenderUI:function(){this.constructor.prototype.afterRenderUI.apply(this,arguments);Ext.apply(this.columnDrop,Ext.ux.grid.ColumnHeaderGroup.prototype.columnDropConfig);Ext.apply(this.splitZone,Ext.ux.grid.ColumnHeaderGroup.prototype.splitZoneConfig)}},splitZoneConfig:{allowHeaderDrag:function(a){return !a.getTarget(null,null,true).hasClass("ux-grid-hd-group-cell")}},columnDropConfig:{getTargetFromEvent:function(b){var a=Ext.lib.Event.getTarget(b);return this.view.findHeaderCell(a)},positionIndicator:function(b,f,d){var c=Ext.ux.grid.ColumnHeaderGroup.prototype.getDragDropData.call(this,b,f,d);if(c===false){return false}var a=c.px+this.proxyOffsets[0];this.proxyTop.setLeftTop(a,c.r.top+this.proxyOffsets[1]);this.proxyTop.show();this.proxyBottom.setLeftTop(a,c.r.bottom);this.proxyBottom.show();return c.pt},onNodeDrop:function(o,A,v,C){var u=C.header;if(u!=o){var x=Ext.ux.grid.ColumnHeaderGroup.prototype.getDragDropData.call(this,u,o,v);if(x===false){return false}var j=this.grid.colModel,z=x.oldIndex<x.newIndex,k=j.rows;for(var f=x.row,p=k.length;f<p;f++){var l=k[f],t=l.length,B=0,q=1,D=t;for(var s=0,m=0;s<t;s++){var g=l[s];if(x.oldIndex>=m&&x.oldIndex<m+g.colspan){B=s}if(x.oldIndex+x.colspan-1>=m&&x.oldIndex+x.colspan-1<m+g.colspan){q=s-B+1}if(x.newIndex>=m&&x.newIndex<m+g.colspan){D=s}m+=g.colspan}var w=l.splice(B,q);k[f]=l.splice(0,D-(z?q:0)).concat(w).concat(l)}for(var y=0;y<x.colspan;y++){var b=x.oldIndex+(z?0:y),a=x.newIndex+(z?-1:y);j.moveColumn(b,a);this.grid.fireEvent("columnmove",b,a)}return true}return false}},getGroupStyle:function(g,c){var e=0,f=true;for(var d=c,a=c+g.colspan;d<a;d++){if(!this.cm.isHidden(d)){var b=this.cm.getColumnWidth(d);if(typeof b=="number"){e+=b}f=false}}return{width:(Ext.isBorderBox||(Ext.isWebKit&&!Ext.isSafari2)?e:Math.max(e-this.borderWidth,0))+"px",hidden:f}},updateGroupStyles:function(b){var g=this.mainHd.query(".x-grid3-header-offset > table"),e=this.getTotalWidth(),k=this.cm.rows;for(var j=0;j<g.length;j++){g[j].style.width=e;if(j<k.length){var h=g[j].firstChild.firstChild.childNodes;for(var d=0,c=0;d<h.length;d++){var f=k[j][d];if((typeof b!="number")||(b>=c&&b<c+f.colspan)){var a=Ext.ux.grid.ColumnHeaderGroup.prototype.getGroupStyle.call(this,f,c);h[d].style.width=a.width;h[d].style.display=a.hidden?"none":""}c+=f.colspan}}}},getGroupRowIndex:function(b){if(b){var a=b.className.match(this.hrowRe);if(a&&a[1]){return parseInt(a[1],10)}}return this.cm.rows.length},getGroupSpan:function(g,c){if(g<0){return{col:0,colspan:this.cm.getColumnCount()}}var e=this.cm.rows[g];if(e){for(var d=0,b=0,a=e.length;d<a;d++){var f=e[d];if(c>=b&&c<b+f.colspan){return{col:b,colspan:f.colspan}}b+=f.colspan}return{col:b,colspan:0}}return{col:c,colspan:1}},getDragDropData:function(f,d,g){if(f.parentNode!=d.parentNode){return false}var m=this.grid.colModel,k=Ext.lib.Event.getPageX(g),a=Ext.lib.Dom.getRegion(d.firstChild),l,q;if((a.right-k)<=(a.right-a.left)/2){l=a.right+this.view.borderWidth;q="after"}else{l=a.left;q="before"}var j=this.view.getCellIndex(f),o=this.view.getCellIndex(d);if(m.isFixed(o)){return false}var p=Ext.ux.grid.ColumnHeaderGroup.prototype.getGroupRowIndex.call(this.view,f),b=Ext.ux.grid.ColumnHeaderGroup.prototype.getGroupSpan.call(this.view,p,j),c=Ext.ux.grid.ColumnHeaderGroup.prototype.getGroupSpan.call(this.view,p,o),j=b.col;o=c.col+(q=="after"?c.colspan:0);if(o>=b.col&&o<=b.col+b.colspan){return false}var i=Ext.ux.grid.ColumnHeaderGroup.prototype.getGroupSpan.call(this.view,p-1,j);if(o<i.col||o>i.col+i.colspan){return false}return{r:a,px:l,pt:q,row:p,oldIndex:j,newIndex:o,colspan:b.colspan}}});